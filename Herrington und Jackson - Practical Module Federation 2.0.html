<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Practical Module Federation 2.0</title><style type="text/css"> .s1 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 90pt; }
 .s2 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 31pt; }
 .s3 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 24.5pt; }
 .s4 { color: #009688; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 31pt; }
 .p, p { color: black; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; margin:0pt; }
 .a { color: #606060; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s5 { color: black; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s6 { color: black; font-family:Georgia, serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 h1 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 86pt; }
 .h2 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 68.5pt; }
 h3 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 48pt; }
 .s8 { color: black; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 14pt; }
 .s9 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 21pt; }
 .s10 { color: black; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s11 { color: black; font-family:Consolas, monospace; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 .s12 { color: black; font-family:"Lucida Sans Unicode", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s13 { color: black; font-family:Georgia, serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 .s14 { color: black; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s15 { color: #A5A5A5; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s16 { color: black; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s17 { color: black; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s18 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s19 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s20 { color: black; font-family:Consolas, monospace; font-style: italic; font-weight: normal; text-decoration: none; font-size: 12pt; }
 h4 { color: #57BEF0; font-family:Georgia, serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 35pt; vertical-align: -3pt; }
 .s21 { color: #57BEF0; font-family:Georgia, serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 35pt; }
 .s23 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 23pt; }
 .s25 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 16pt; }
 .s28 { color: #98C378; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s29 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s30 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; }
 .s31 { color: #24292E; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s32 { color: #24292E; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 48pt; }
 .s33 { color: #24292E; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 31pt; }
 li {display: block; }
 #l1 {padding-left: 0pt; }
 #l1> li:before {content: "- "; color: #57BEF0; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 35pt; vertical-align: -3pt; }
 #l2 {padding-left: 0pt; }
 #l2> li:before {content: "- "; color: #57BEF0; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 35pt; vertical-align: -3pt; }
 #l3 {padding-left: 0pt; }
 #l3> li:before {content: "- "; color: #57BEF0; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 35pt; vertical-align: -3pt; }
 #l4 {padding-left: 0pt;counter-reset: d1 0; }
 #l4> li:before {counter-increment: d1; content: counter(d1, decimal)". "; color: black; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 #l5 {padding-left: 0pt; }
 #l5> li:before {content: "- "; color: #57BEF0; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 35pt; vertical-align: -3pt; }
 #l6 {padding-left: 0pt; }
 #l6> li:before {content: "- "; color: #57BEF0; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 35pt; vertical-align: -3pt; }
 #l7 {padding-left: 0pt; }
 #l7> li:before {content: "- "; color: #57BEF0; font-family:Georgia, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 35pt; vertical-align: -3pt; }
 td>p {display: inline; }
</style></head><body><p style="text-indent: 0pt;text-align: left;"><span><img width="817" height="209" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_001.png"/></span></p><p style="padding-top: 3pt;padding-left: 144pt;text-indent: 0pt;text-align: left;"><span><img width="344" height="395" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_002.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p><p class="s1" style="padding-left: 5pt;text-indent: 0pt;line-height: 78%;text-align: left;">PRACTICAL  MODULE FEDERATION</p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p><p class="s2" style="padding-left: 237pt;text-indent: 0pt;text-align: left;">J<span class="s3">ACK  </span>H<span class="s3">ERRINGTON  </span>&amp;  Z<span class="s3">ACK  </span>J<span class="s3">ACKSON</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s2" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">Book Version 2.0</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">PROLOGUE</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">We’ve all remarked at some point how rapidly the world of Javascript changes, or how frequently a new framework arises. But rarely does a completely new architectural paradigm arise. Module Federation is a paradigm shift in how we organize and build our applications. This book, Practical Module Federation, seeks to give you not just a solid understanding of what Module Federation is and how to configure, build, and deploy it, but to do so in the context of the practical applications you will be building with it.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This book is copyrighted © 2020-2021, Zack Jackson and Jack Herrington, all rights are reserved.</p><p class="s4" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">CONTENTS</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_003.png"/></span></p><p style="text-indent: 0pt;line-height: 11pt;text-align: left;"><br/></p><p style="padding-top: 2pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark1" class="a">Preface                                                                                                                         3</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark3" class="a">Micro-Frontends And Module Federation                                                                     6</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark5" class="a">Getting Started                                                                                                                   18</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark7" class="a">Getting Started With Create React App                                                                      36</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark9" class="a">How Module Federation Works                                                                                   44</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark11" class="a">Deploying Federated Modules                                                                                    49</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark13" class="a">Resilient Sharing of React Components                                                                     55</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark15" class="a">React State Sharing Options                                                                                       64</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark17" class="a">Resilient Function and Static Data Sharing                                                                     104</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark19" class="a">Dynamically Loading Federated Modules                                                                               113</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark21" class="a">Shared Libraries And Versioning                                                                              122</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark23" class="a">Non-React View Frameworks                                                                                          130</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark25" class="a">Resilient Header/Footer                                                                                                   138</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark27" class="a">A/B Tests                                                                                                                          145</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark29" class="a">Live Preview Between Applications                                                                          153</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark31" class="a">Fully Federated Sites                                                                                                       161</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark33" class="a">Alternative Deployment Options                                                                               175</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark35" class="a">Medusa                                                                                                                            182</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark37" class="a">Frequently Asked Questions                                                                                     185</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark39" class="a">Troubleshooting                                                                                                               188</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark41" class="a">Reference                                                                                                                         194</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark43" class="a">Glossary                                                                                                                           201</a></p><p style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a href="#bookmark45" class="a">About the Authors                                                                                                     204</a></p><p class="s4" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a name="bookmark0">PREFACE</a><a name="bookmark1">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_004.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Module Federation is an advanced use topic for the Webpack bundler starting with version 5. In order to get the most out of this book you should have a passing familiarity with Webpack up to and including version 4. You should know what it’s useful for (bundling Javascript), how it’s configured (through configuration files written in Javascript) and how it’s extended (through plugins). This book also deals extensively with the React view framework and with web development technologies in general.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">SETUP</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 161%;text-align: justify;">You will want to have <span class="s5">node </span>running on your local machine at version 14 or greater to run Webpack builds and execute the server code. You should also have <span class="s5">git </span>and <span class="s5">yarn </span>installed for build tooling.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">HOW TO READ THIS BOOK</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">The first three chapters of this book provide a step-by-step walkthrough of the architectural role of Module Federation, how to use it in a simple case, and then a walk through of the mechanics of how it works internally. The chapters that follow on from that weave through a number of related topics to give you lots of detail and options on how to get the most out of Module Federation in practical real world projects at scale. It’s recommended that for those chapters you have the code downloaded and experiment with the projects as you run them.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">As you read through the book you might be asking yourself why the chapters are not given sequential numbers but are instead in <span class="s5">[section].[chapter] </span>form. The book is structured that way so that it’s easier to update.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">SUBSCRIPTION</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This book is more than just a book. This original intention of this book was to be a year long subscription after its initial release. In that time Module Federation went from a beta feature into full blown production, and the book dutifully tracked along with that journey. We still honor that subscription. If you bought a subscription to 1.x you will get updates to the 2.x version of the book <b>for free</b>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">After the release of Module Federation as a full fledged feature of Webpack 5 there weren’t many updates to the book. This was primarily because the focus of Module Federation efforts were directed towards getting support into the major frameworks, which has been slow going.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">At the end of 2021 we feel that there is enough new material in the world of Module Federation that it’s time for a refresh of the book, and thus, the 2.0 release. Some more updates should follow with additional information. Particularly if there is a shift in NextJS support for the feature.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><h1 style="padding-left: 32pt;text-indent: 0pt;line-height: 95pt;text-align: left;">P<span class="h2">ART </span>O<span class="h2">NE</span></h1><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="721" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_005.png"/></span></p><h3 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">GETTING TO KNOW MODULE FEDERATION</h3><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.1</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark2">MICRO-FRONTENDS AND MODULE FEDERATION</a><a name="bookmark3">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_006.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Micro-Frontends are often the first way that folks encounter Module Federation. So let’s start off our investigation of Module Federation by first learning about what Micro-Frontends are, and then how Module Federation can be applied to them, and more!</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">WHAT IS A MICRO-FRONTEND?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Micro-Frontends (MFEs) are often described as “Micro-services for the frontend”. Where micro-services architecture allows individual teams to deploy independent services that work together to create a complete backend systems architecture, MFEs allow multiple teams to independently deploy frontend experience code to one or more applications that provide a complete experience to the frontend consumer.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">If that’s a bit too much jargon for, let me provide some examples. The header and footer of a website are MFEs, as they are usually functionally isolated from the content that sits between the header and footer. Another example would be a carousel of products. Where the carousel knows how to manage it’s on view state and make requests to the backend micro-services to get the list of products to display.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">The key attributes of an MFE are that they are <b>self contained </b>and <b>independently deployable</b>. They are self-contained because they contain all of the business logic that is specific to their function and behavior. That being said MFEs are <i>hosted </i>on a page,</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">and that page often includes an <b>Application Shell </b>(or just Shell for short) that provides global services such as user identity, authenticated API access and so on.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">The second key attribute, independent deploy, is achievable in multiple ways. You can either deploy MFEs as build-time dependencies, or as a runtime dependencies. There are advantages and disadvantages to both techniques.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><ul id="l1"><li style="padding-left: 22pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">Build time deployment <span class="p">- Build time deployment means that the MFEs are maintained in separate modules but are still available at build-time and the host</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 24pt;text-align: left;">applications need to be re-deployed for a change to go live. Technology options here include using NPM modules through a private artifact repository, or through <u>Bit</u>. The big advantage here is that your application deploys as a complete unit. The disadvantage is that different versions of the same MFE might be deployed on individual applications at any given point in time.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 32pt;text-align: justify;"><p class="s6" style="display: inline;">Runtime deployment <span class="p">- Runtime deployment means that the MFEs are</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">independently deployed to production, and are consumed at runtime by the host</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 150%;text-align: left;">applications. Module Federation is one way to achieve runtime dependencies. EcmaScript Modules (ESMs) are another. Host applications do not need to re- deploy to see a change go live, and all application have the same version of the MFE code immediately. The downside is that that host applications are no longer complete at the end of the build, there are runtime dependencies that need to be loaded in order for the host application to be complete.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">There are strong advantages and disadvantages to each approach. But the key takeaway here is that MFEs can be either build-time or runtime deployed.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">WHY  MICRO-FRONTENDS?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">We’ve talked about what MFEs are, let’s now talk about why they are important.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Most applications start as “monoliths”. A monolithic application is a single application that contains all of the pages, components, business logic, etc. to render every single route on a website. They get the name “monolith” once they get to the point where it takes a considerable amount of time to deploy either for production, or often just during development.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Once they get to that stage a company will often “monolith-bust” by taking features out of the monolith one-by-one, most often route by route, to create a set of applications that are independently deployable and maintainable. The resulting architecture is sometimes called a “polylith” or “multi-application architecture”.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Shown below is a monolithic eCommerce application that became a polylith.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 79pt;text-indent: 0pt;text-align: left;"><span><img width="521" height="145" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_007.png"/></span></p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The original application that started out with forty developers became three frontend application teams with ten developers each, managing the Home, Search and Checkout experience. Those three teams share a global header footer provided by the five person “Nav” team. And they are all backed up by a five person Shared Infrastructure team that manages Design System components, API access libraries, and so on.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This architecture already has it’s first Micro-Frontend (MFE), the Nav teams Header and Footer, which is, in this case, build-time deployed through an NPM module.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The big advantage of this move from a monolith to a multi-application architecture is  to get back to the speed of independent deployment that the team had at the start of the monolith’s development. Instead of everyone having to wait for deployment on a “train”, each team, Home, Search and Checkout, can now deploy their changes as often as they like.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">As the name “polylith” suggests, these applications even broken up can become unweildy. Which is one reason by MFEs deployed as runtime dependencies becomes more attractive. For example a team could develop a Product Carousel and deploy it as a runtime dependency as shown below:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 152pt;text-indent: 0pt;text-align: left;"><span><img width="324" height="229" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_008.png"/></span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">And now that Product Carousel team can deploy updates to their carousel both the Home and Search applications without requiring those applications to re-deploy. And this is where we get into the value of Module Federation.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">MODULE FEDERATION AND RUNTIME DEPLOYED MFES</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Module Federation is a feature built into Webpack 5 that makes it very easy to share code between applications. But let’s start by looking at what is familiar, NPM libraries, and work forward to Module Federation in steps.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The figure below shows two applications, Home and Search. The Home page team currently has a Product Carousel on their page that we would like to reuse as an MFE on the Search page.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 170pt;text-indent: 0pt;text-align: left;"><span><img width="281" height="81" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_009.png"/></span></p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">To share this Product Carousel at build-time we could extract that code into a shared NPM library, as shown below. Then link it to both applications as a shared dependency.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 170pt;text-indent: 0pt;text-align: left;"><span><img width="295" height="148" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_010.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This is a very reliable way to go, but there are two drawbacks. First, for the Home page team, fixing issues in the Product Carousel becomes laborious. They need to change projects, make the changes, fix the tests, bump the version and deploy the library. Then</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">they need to bump the version of the library in both Home and Search and get those applications deployed.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The second drawback is that when the Product Carousel is updated there is no guarantee that both the Home and Search pages will show the same versions of the carousel, because either or both, could have deployed with older versions of the library.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">So what we want is a runtime dependency, and before Module Federation we would have had to do something like this:</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 106pt;text-indent: 0pt;text-align: left;"><span><img width="441" height="211" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_011.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">We would have extracted the Product Carousel into its own project that would package the code up and deploy it to S3. There are lots of ways to do that but there are no standard ways to do it. In addition we would create a shared shim library and use NPM to deploy that to H0me and Search. And that shim library would manage loading the code from S3 and embedding it on the page.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The advantage here is that now the code is independently deployable. Once the Product Carousel team deploys the Home and Search applications will get the new code immediately.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The are several downsides. As with the NPM approach the code for the Carousel needs to be extracted from its original application. In addition a custom deployment infrastructure needs to be built. And once that’s done the integration isn’t seamless because the shim library will need to manage runtime loading and running the code.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">By contrast, Module Federation makes runtime deployment look super easy:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 140pt;text-indent: 0pt;text-align: left;"><span><img width="366" height="105" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_012.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The Home page application simply exposes the Product Carousel as a runtime dependency (called a remote) and the Search applications points to that dependency in its Webpack configuration file. At that point the Search application imports and uses the Product Carousel as it would any other component.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This Wasn’t A Problem Before Bundlers</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">Ironically, runtime dependencies weren’t a problem before bundlers. Before bundlers, like Webpack, Parcel, Rollup (and more), JavaScript was deployed to as individual files, and dependencies were managed, if they were managed at all, by loaders like <span class="s5">requirejs </span>that would ensure that global dependencies were available before your code would load.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Bundlers gave us the advantage of having a single file to deploy. Or later a set of split files to deploy that the system would manage as you performed asynchronous imports.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">But with that advantage came the loss of runtime loadable dependencies, which it appears, are as important now as they were then. I guess you only realize something’s value once it’s gone.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">MODULE FEDERATION ADVANTAGES</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">There are several advantages to the Module Federation approach.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p></li><li style="padding-left: 22pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">Code remains in-place <span class="p">- For one of the applications, the rendering code remains in-place and is not modified.</span></p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 32pt;text-align: left;"><p class="s6" style="display: inline;">No framework <span class="p">- As long as both applications are using the same view framework,</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">then they can both use the same code.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">No code loaders <span class="p">- Micro-FE frameworks (i.e. Single-SPA) are often coupled with</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">code loaders, like SystemJS, that work in parallel with the babel and Webpack</p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 24pt;text-align: left;">imports that engineers are used to. Importing a federated module works just like any normal import. It just happens to be remote. Unlike other approaches, Module Federation does not require any alterations to existing codebases.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 32pt;text-align: left;"><p class="s6" style="display: inline;">Applies to any Javascript <span class="p">- Where Micro-Frontend frameworks work only on UI</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">components, Module Federation can be used for any type of Javascript; UI</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">components, business logic, i18n strings, etc. Any Javascript can be shared.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Applies beyond Javascript <span class="p">- While many frameworks focus heavily on the</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">Javascript aspects. Module Federation will work with file that Webpack is currently</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">able to process today <i>into JavaScript </i>today.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Universal <span class="p">- Module Federation can be used on any platform that uses the</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">Javascript runtime. Browser, Node, Electron, Web Worker. It also does not require a</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 150%;text-align: left;">specific module type. Many frameworks require use of SystemJD or UMD. Module Federation will work with any type currently available. AMD, UMD, CommonJS, SystemJS, window variable and so on.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">There is one more key benefit to Micro-Frontends that we have yet to discuss; MFEs across frameworks.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">FRAMEWORK  NEUTRALITY</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">So far we have assumed that both the host application (or shell) and the Micro- Frontends are using the same view framework (e.g. React, Vue, Svelte, etc.). But, what if they aren’t, is there a way to manage that? Absolutely. The industry standard solution to that problem is a system named <u>Single-SPA</u>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Single-SPA packages components written in one of many different supported frameworks into a platform agnostic “parcel”. Then host applications can use a Single- SPA client to embed a parceled component on the page. In this way a Vue application can host React components or vice versa. Single-SPA manages all of that interaction.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This means that as you are thinking about migrating experiences from a monolith to a multiple application architecture you can stop thinking about that migration in terms of complete routes and instead start thinking about in terms of porting portions of a page.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">One thing that Single-SPA does not handle is loading the parceled code into the application. This can being done as either a build-time dependency, or as a runtime dependency using Module Federation or SystemJS.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that you know more about Micro-Frontends and how runtime and build-time dependencies interact with Micro-Frontends let’s now rethink our approach to building applications.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">COMPOSABILITY</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Recently <u>Gartner </u>has started pushing the concept of “composable commerce”. The concept has both technical and organizational aspects. On the technical side the concept is fairly simple, instead of thinking about an eCommerce applications in terms of complete experiences (e.g. Home, Search, Cart, Checkout, etc.) you instead think in terms of <i>capabilities </i>and <i>experience elements </i>that can be composed into complete customer facing experiences.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">For example you can take a product display element, an “add to cart” element and a product carousel element and compose them into a complete custom experience for a new product. And each of those elements can be maintained by a separate team, deployed as Micro-Frontends (either as build-time or runtime dependencies) and then composed together in a myriad of ways.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Micro-Frontends and Module Federation fit perfectly into this composable model. And this model of composability doesn’t need to be constrained just to commerce. You can apply this to any type of application, and in fact the composability model ends up blending application types. For example, a commerce experience could include elements from a Content Management System (CMS), or vice versa.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The key point here is that you need to look at experiences at a level below the granularity of a “page” or a “route” and instead into the reusability of elements within each “page”.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">CAVEAT EMPTOR (BUYER BEWARE)</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">To reinforce one last time; Module Federation is not the only way to accomplish a Micro-Frontend architecture. Micro-Frontends can be developed using safer and less complex build-time techniques, such as NPM library sharing, Monorepos and products like <u>Bit</u>. Unless your requirements specifically require runtime sharing it is far easier to use a buildtime approach.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Additionally, Module Federation is very complex, and should only be attempted by experienced web developers with a strong background in debugging though issues such as CORS, library versioning and singletons.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This book will try and steer you around the complex runtime issues associated with Module Federation. However, we strongly recommend that you take a step-by-step approach to using Module Federation in your environment. Never continue on to the next layer of complexity without first ensuring that the code works as-is. And it’s strongly recommended that at each point where you achieve a working system that you commit to source code control before moving onto the next change. That will ensure that you have a safe position to fall back on when you encounter problems.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Make no mistake; <b>you will run into issues implementing Module Federation</b>. Having strong debugging skills and debugging complex issues is a prerequisite for using federated modules successfully. This is not a core stability issue with Module Federation itself, which is battle tested, these are issues of library compatibility, deployment issues and more that are layered on top of Module Federation.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Please feel free to ask for your money back on this purchase if you feel like Module Federation is not the right fit for you, your current skill level or skill set.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that you have a decent understanding of what Module Federation is and how it changes the landscape of code sharing in Javascript. The chapters of the book that follow walk through setting up Module Federation, sharing different types of code with practical examples that you can follow on your existing projects.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.2</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark4">GETTING STARTED</a><a name="bookmark5">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_013.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_014.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_015.png"/></span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 161%;text-align: justify;">The easiest way to start learning Module Federation is to try it out. To do that we will create two applications; <span class="s5">host </span>and <span class="s5">nav</span>. The <span class="s5">home </span>page application will consume and render a <span class="s5">Header </span>React component that is exposed by the nav application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">However, before we can do that we need to create a simple monorepo.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">THE BOOTER MONOREPO</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">I can hear you screaming; “I thought I didn’t have to have a monorepo for Module Federation!” You don’t, and this isn’t a monorepo in the traditional way of binding applications and library dependencies together. It doesn’t do that. What it does do is get all the applications to start (boot) at the same time easily.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">We use the same “booted monorepo” in each case. So we start by creating the</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_016.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">getting-started <span class="p">directory and a sub-directory named named </span>packages<span class="p">.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">% <b>mkdir getting-started</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% <b>cd getting-started</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% <b>mkdir packages</b></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Then within the <span class="s5">getting-started </span>directory we add this <span class="s5">package.json</span>:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;name&quot;: &quot;packages&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;version&quot;: &quot;1.0.0&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;main&quot;: &quot;index.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;license&quot;: &quot;MIT&quot;, &quot;private&quot;: true, &quot;scripts&quot;: {</p><p class="s11" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&quot;start&quot;: &quot;concurrently \&quot;wsrun --parallel start\&quot;&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;workspaces&quot;: [</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&quot;packages/*&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">],</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;devDependencies&quot;: { &quot;concurrently&quot;: &quot;^5.2.0&quot;,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&quot;wsrun&quot;: &quot;^5.2.0&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="433" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_017.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">All this does is run the <span class="s5">start </span>script on any application located in the <span class="s5">packages</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">directory.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">So now that we have that set up we need to create our applications.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">CREATING THE APPLICATIONS</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="384" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_018.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">To create the <span class="s5">host </span>application within the <span class="s5">packages </span>directory we will use <span class="s5">npx create-mf-app </span>like  so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">% <b>npx create-mf-app</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">? Pick the name of your app: <b>host</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">? Project Type: <b>Application</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">? Port number: <b>3000</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">? Framework: <b>react</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">? Language: <b>javascript</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">? CSS: <b>Tailwind</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 256%;text-align: left;">Your &#39;host&#39; project is ready to go. Next steps:</p><p class="s12" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">▶  <span class="s10">cd host</span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">▶  <span class="s10">npm install</span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">▶  <span class="s10">npm start</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">We do exactly the name thing for the <span class="s5">nav </span>application where the only difference is in the port number, which we will set to 3001.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The create-mf-app is a little application that is designed to build lightweight applications pre-configured for Module Federation in one of ten (as of this writing) different view frameworks. The list of frameworks is pretty comprehensive, but it leaves out frameworks like Angular which are compatible with Module Federation but which are more complex to set up.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_019.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">With these two applications built we can run start in the parent getting-started directory.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">% <b>cd getting-started</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% <b>yarn</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% <b>yarn start</b></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">That will fire up both applications simultaneously and you’ll get something that looks like this.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 139pt;text-indent: 0pt;text-align: left;"><span><img width="353" height="246" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_020.png"/></span></p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 158%;text-align: left;">So let’s have a look around at the application to see how this is all put together. The first place to look is in <span class="s5">src/App.jsx </span>in the <span class="s5">host </span>application.</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import React from &quot;react&quot;;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 256%;text-align: left;">import ReactDOM from &quot;react-dom&quot;; import &quot;./index.scss&quot;;</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Name: host&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Framework: react&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Language: JavaScript&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;CSS: Tailwind&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(&lt;App /&gt;, document.getElementById(&quot;app&quot;));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="362" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_021.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">In this simple React application we create new component called <span class="s5">App </span>and render it on the page. This React application is then rendered into the HTML page contained in <span class="s5">src/index.html</span>.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">To get all this running we are using a combination of <span class="s5">babel </span>to transpile the code and Webpack to bundle the code and to run the development server. If we look into the <span class="s5">package.json </span>we can see the dependencies and these are described below.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><table style="border-collapse:collapse;width:539pt;margin-left:5pt" cellspacing="0"><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s13" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Dependency</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s13" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Description</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">@babel/runtime</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Babel runtime functions to support ES6 code.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">react</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The React view library.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">react-dom</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The React DOM library which handles rendering React trees</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">into DOM elements.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">@babel/core</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The engine of the Babel code transpiling system.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">@babel/plugin-</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">transform-runtime</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Runtime helpers so that we can use ES6 syntax.</p></td></tr></table><table style="border-collapse:collapse;width:539pt;margin-left:5pt" cellspacing="0"><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s13" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Dependency</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s13" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Description</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">@babel/preset-react</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Convenient babel presets for react.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">@babel/preset-env</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">A present to bring import environment variables into the</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">babel transpiling process.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">babel-loader</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">A webpack loader the runs babel on Javascript code before it’s</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">bundled.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">css-loader</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">A webpack loader that allows the import of CSS files into</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">Javascript files.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">html-webpack-plugin</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">A plugin for webpack that automatically inserts a script tag</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">that references the bundle into the HTML template.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">postcss</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">CSS pre-processor for Tailwind.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">postcss-loader</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Webpack loader to run postcss.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">style-loader</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">A plugin that works in conjunction with CSS loader to import</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">CSS into webpack bundles.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">webpack</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The webpack engine</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">webpack-cli</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The webpack command line interface</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">webpack-dev-server</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The webpack development server we use to run the</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">application.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">tailwindcss</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The Tailwind CSS library.</p></td></tr></table><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 153%;text-align: left;">So far there is really nothing new to see here. These are all standard dependencies that should be familiar to anyone who has written Webpacked React applications. The important element here is that all of these dependencies are at the latest version, and in particular that Webpack has a version of <span class="s5">5.57.1 </span>or higher.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="242" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_022.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">The fun begins in the <span class="s5">webpack.config.js </span>file in the <span class="s5">host </span>application, shown below:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const HtmlWebPackPlugin = require(&quot;html-webpack-plugin&quot;); const ModuleFederationPlugin = require(&quot;webpack/lib/container/ ModuleFederationPlugin&quot;);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const deps = require(&quot;./package.json&quot;).dependencies; module.exports = {</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">output: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">publicPath: &quot;http://localhost:3000/&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_023.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The first thing we do is define the public URL base path for the application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">resolve: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">extensions: [&quot;.tsx&quot;, &quot;.ts&quot;, &quot;.jsx&quot;, &quot;.js&quot;, &quot;.json&quot;],</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="122" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_024.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Next we specify and code file extensions that we want to look for if we leave extensions off the import name.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">devServer: { port: 3000,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">historyApiFallback: true,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 158%;text-align: left;">This is where we specify the development server port number, and we tell the dev server to serve <span class="s5">index.html </span>for any unknown routes.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="554" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_025.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">The next thing we need to do is to set up the modules that will process all the files.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">module: { rules: [</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">test: /\.m?js/,</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">type: &quot;javascript/auto&quot;, resolve: {</p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">fullySpecified: false,</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">test: /\.(css|s[ac]ss)$/i,</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">use: [&quot;style-loader&quot;, &quot;css-loader&quot;, &quot;postcss-loader&quot;],</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">test: /\.(ts|tsx|js|jsx)$/, exclude: /node_modules/, use: {</p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">loader: &quot;babel-loader&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">],</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This makes sure that we properly process all the JavaScript, TypeScript, CSS or ESM files that are referenced in the application.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Finally we need to specify the plugins, including, most importantly, the</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="602" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_026.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ModuleFederationPlugin<span class="p">.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">plugins: [</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">exposes: {}, shared: {</p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">...deps, react: {</p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;line-height: 128%;text-align: left;">singleton: true, requiredVersion: deps.react,</p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 77pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;react-dom&quot;: { singleton: true,</p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">requiredVersion: deps[&quot;react-dom&quot;],</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new HtmlWebPackPlugin({ template: &quot;./src/index.html&quot;,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">],</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">Here we add two plugins, the <span class="s5">ModuleFederationPlugin </span>that will share our consume shared code, and the <span class="s5">HtmlWebPackPlugin </span>that will process the <span class="s5">index.html </span>template.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Now we get to the interesting part where we are set up our <span class="s5">ModuleFederationPlugin</span>. We will get into a lot more detail as we go but the fields that configure the module federation plugin are described in the table below.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><table style="border-collapse:collapse;width:539pt;margin-left:5pt" cellspacing="0"><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s13" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Field</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s13" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Description</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">name</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The name of this application. Never have conflicting names,</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">always make sure every federated app has a unique name</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">filename</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The filename to use for the remote entry file</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">remotes</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The remotes this application will consume.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">exports</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F" bgcolor="#F2F4F7"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The files this application will expose as remotes to other</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">applications.</p></td></tr><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">shared</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:1pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:1pt;border-right-color:#7F7F7F"><p class="s14" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">The libraries the application will share with other</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s14" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">applications.</p></td></tr></table><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The critical concepts here are <i>remotes</i>, <i>exposes </i>and <i>shared</i>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p></li><li style="padding-left: 22pt;text-indent: -17pt;text-align: left;"><p style="display: inline;"><b>Remotes </b>- These are the names of the other federated module applications that this application will consume code from. For example, if this <span class="s5">home </span>application consumes</p><p style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;line-height: 25pt;text-align: left;">code from an application called <span class="s5">nav </span>that will have the header, then nav is a “remote” and should be listed here.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 32pt;text-align: left;"><p class="s6" style="display: inline;">Exposes <span class="p">- These are the files that this application will export as remotes to other</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">applications.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Shared <span class="p">- A list of all the libraries that this application will share with other</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">applications in support of files listed in the exposes section. For example, if you</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 157%;text-align: left;">export a React component you will want to list <span class="s5">react </span>in the shared section because it’s required to run your code.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that we understand the project and how it works it’s time to start making some modifications.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">CREATING THE HEADER</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now that we have our two applications running lets create a <span class="s5">Header </span>component in the</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">nav <span class="p">application in </span>packages/nav/src/Header.jsx<span class="p">. Something like this:</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="241" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_027.png"/></span></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import React from &quot;react&quot;; const Header = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white&quot;&gt; I&#39;m the header!</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default Header;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Nothing too interesting outside of the Tailwind classes in the <span class="s5">className </span>attribute.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="266" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_028.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">To make sure it works let’s add it to the App component by replacing its contents with:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import Header from &quot;./Header&quot;;</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import &quot;./index.scss&quot;; const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10&quot;&gt;Nav project&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">If that works then it’s time to expose that <span class="s5">Header </span>component so that it can be consumed by the <span class="s5">host </span>application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="241" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_029.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">To do that we modify the <span class="s5">webpack.config.js </span>in <span class="s5">packages/nav </span>to look like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;nav&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;./Header&quot;: &quot;./src/Header&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">shared: { ... },</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">That’s all it takes to expose the <span class="s5">Header</span>. We just name it create a key with the name</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;./Header&quot; <span class="p">and we the value that is the path to the source file.</span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">The next thing we need to do is to stop the <span class="s5">yarn start </span>we ran in the top level directory and re-run the <span class="s5">yarn start </span>so that we pick up the changes to the Webpack configuration.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now we are ready to consume the <span class="s5">Header </span>component in the <span class="s5">host </span>application.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">CONSUMING THE HEADER</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="241" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_030.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Let’s jump over to the <span class="s5">webpack.config.js </span>in the <span class="s5">packages/host </span>directory and make a small modification.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s11" style="text-indent: 0pt;text-align: center;">&quot;my-nav&quot;: &quot;nav@http://localhost:3001/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">exposes: {}, shared: { ... },</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">Once we restart the servers we can the access our Header. But how? We’ll we have defined that there is a new “remote” named <span class="s5">my-nav </span>at the name and URL specified in the value. The name is <span class="s5">nav </span>because that’s what is specified in the Webpack configuration of the nav application. And the <span class="s5">remoteEntry.js </span>file is also named in that configuration file.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now let’s go to the <span class="s5">App.jsx </span>file and consume the <span class="s5">Header </span>component.</p><p class="s11" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">const Header = React.lazy(() =&gt; import(&quot;my-nav/Header&quot;));</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import &quot;./index.scss&quot;; const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div /&gt;}&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10&quot;&gt;Home page&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="314" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_031.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">This loads the <span class="s5">Header </span>lazily using an asynchronous import and then renders it within a <span class="s5">Suspense</span>. This allows React to only render the component when the code is downloaded and ready to go.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">And that’s all it takes to share a component between these two applications. In fact, you can try it for yourself by modifying the code in the Header component and see the changes immediately after refreshing the <span class="s5">host </span>page.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">GETTING NAMING RIGHT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="375" height="433" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_032.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 153%;text-align: justify;">It’s important to know what parts of the web pack configuration of one application need to match in the corresponding parts of the consuming applications web pack config. In the figure below we show the key parts of the Nav applications web pack config and how they map into the <span class="s5">host </span>application’s Webpack config.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s15" style="padding-top: 4pt;padding-left: 145pt;text-indent: 0pt;text-align: left;">Nav</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s16" style="padding-left: 155pt;text-indent: -7pt;line-height: 132%;text-align: left;">module.exports = { output: {</p><p class="s16" style="padding-left: 163pt;text-indent: 0pt;text-align: left;">publicPath: &quot;http://localhost:3001/&quot;,</p><p class="s16" style="padding-top: 2pt;padding-left: 155pt;text-indent: 0pt;text-align: left;">},</p><p class="s16" style="padding-top: 2pt;padding-left: 155pt;text-indent: 0pt;text-align: left;">plugins: [</p><p class="s16" style="padding-top: 2pt;padding-left: 170pt;text-indent: -7pt;line-height: 132%;text-align: left;">new ModuleFederationPlugin({ name: &quot;nav&quot;,</p><p class="s16" style="padding-left: 170pt;text-indent: 0pt;line-height: 132%;text-align: left;">fileName: &quot;remoteEntry.js&quot;, exposes: {</p><p class="s16" style="padding-left: 178pt;text-indent: 0pt;text-align: left;">&quot;./Header”: &quot;./src/Header&quot;</p><p class="s16" style="padding-top: 2pt;text-indent: 0pt;text-align: center;">}</p><p class="s16" style="padding-top: 2pt;text-indent: 0pt;text-align: center;">}),</p><p class="s16" style="padding-top: 2pt;padding-left: 155pt;text-indent: 0pt;text-align: left;">],</p><p class="s16" style="padding-top: 2pt;padding-left: 148pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s15" style="padding-top: 4pt;padding-left: 145pt;text-indent: 0pt;text-align: left;">Home</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s15" style="padding-left: 151pt;text-indent: 0pt;text-align: left;">src/App.jsx</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s16" style="padding-left: 159pt;text-indent: 0pt;text-align: left;">const Header = React.lazy(() =&gt; import(&quot;my-nav/Header&quot;));</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s16" style="padding-top: 4pt;padding-left: 159pt;text-indent: -7pt;line-height: 132%;text-align: left;">module.exports = { plugins: [</p><p class="s16" style="padding-left: 174pt;text-indent: -7pt;line-height: 132%;text-align: left;">new ModuleFederationPlugin({ name: &quot;home&quot;,</p><p class="s16" style="padding-left: 174pt;text-indent: 0pt;text-align: left;">remotes: {</p><p class="s16" style="padding-top: 2pt;padding-left: 181pt;text-indent: 0pt;text-align: left;">&quot;my-nav&quot;:  &quot;nav@http://localhost:3001/remoteEntry.js&quot;</p><p class="s16" style="padding-top: 2pt;text-indent: 0pt;text-align: center;">}</p><p class="s16" style="padding-top: 2pt;text-indent: 0pt;text-align: center;">}),</p><p class="s16" style="padding-top: 2pt;padding-left: 159pt;text-indent: 0pt;text-align: left;">],</p><p class="s16" style="padding-top: 2pt;padding-left: 151pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: left;">The <span class="s5">publicPath </span>is the base of the remote URL which ends with the <span class="s5">fileName</span>. And then before that is the remote name defined using name in the Module Federation Plugin configuration. You can also change the name of the import by changing the key to whatever you like, for example in this case <span class="s5">my-nav</span>.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">PROPERLY SHARING REACT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Throughout this book we will define the shared key in the</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_033.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ModuleFederationPlugin <span class="p">configuration object like this:</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">shared: { ... }, // Shared React dependencies</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="338" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_034.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This is just shorthand for this full configuration:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const deps = require(&quot;./package.json&quot;).dependencies;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">shared: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">...deps, react: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">singleton: true, requiredVersion: deps.react,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 41pt;text-indent: -21pt;line-height: 128%;text-align: left;">&quot;react-dom&quot;: { singleton: true,</p><p class="s10" style="padding-left: 32pt;text-indent: 0pt;text-align: center;">requiredVersion: deps[&quot;react-dom&quot;],</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 156%;text-align: left;">It’s nothing sinister, this configuration is long and it would have taken up a lot of space on the page. But it is worth talking about why this shared configuration is set up this way. What we are doing is pulling the dependencies, as on object, from the <span class="s5">package.json </span>file. We are then setting the shared object to match the object from <span class="s5">package.json</span>, but we are overriding <span class="s5">react </span>and <span class="s5">react-dom </span>to set them to singleton mode and pin the to their specific current version.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: left;">They are marked as singletons because those two libraries; <span class="s5">react </span>and <span class="s5">react-dom </span>have internal state and you can’t have multiple copies of them on the same page. That qualifies them a “singletons” and telling Webpack this ensures that it will never load more than one copy of <span class="s5">react</span>, or <span class="s5">react-dom </span>on the page at one time.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The value of the spread of the <span class="s5">deps </span>object (i.e. <span class="s5">...deps</span>) is that all of the other runtime dependencies for the application are added to the list of shared libraries automatically. So if you bring in <span class="s5">antd</span>, or <span class="s5">lodash</span>, those will be automatically shared.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_035.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">It’s worth noting that <span class="s5">react </span>and <span class="s5">react-dom </span>aren’t the only singletons out there. For example, most CSS-in-JS libraries are also singletons. And if you find that you are seeing troubles sharing something <span class="s5">@emotion/core </span>then you should consider treating that exactly the same way as react, like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">shared: { ... &quot;@emotion/core&quot;: {</p><p class="s10" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">singleton: true,</p><p class="s10" style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">requiredVersion: deps[&quot;@emotion/core&quot;],</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Any time you have globally shared state within a module, which is very easy to do, then your library becomes a singleton.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">The different modes for the <span class="s5">shared </span>key are explained in more in the appendices at the end of the book. But if you are using React then we strongly recommend adopting this standard pattern.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">MIGRATING EXISTING APPLICATIONS</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 153%;text-align: left;">So what do you do if you have an existing Webpack 4 application and you want to expose parts of it to other applications, or use module federation to consume parts from other applications. The most direct route is to upgrade from Webpack 4 to Webpack 5 and then add the <span class="s5">ModuleFederationPlugin </span>and customize it using the techniques we’ve discussed so far. Thankfully the Webpack documentation has <u>excellent upgrading documentation </u>you can follow.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 156%;text-align: left;">If you don’t want to upgrade you might consider creating a sidecar Webpack 5 project in a subdirectory of the application. This sidecar application would include Webpack 5 along with any dependencies from the original project. The <span class="s5">webpack.config.js </span>file for the sidecar would then use the <span class="s5">ModuleFederationPlugin </span>to expose the files from the host application using relative references to the source. This sidecar technique is described and demonstrated in chapter on Alternative Deployment Options.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The create-mf-app command is one way to build applications that use Module Federation in the next chapter we will show how to use Module Federation in applications created using Create React App.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.3</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark6">GETTING STARTED WITH CREATE REACT APP</a><a name="bookmark7">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_036.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_037.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_038.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Create React App has updated to the latest Webpack which makes it much easier to use Module Federation. Module Federation support isn’t baked into Create React App but that doesn’t mean you have to eject to be able to use it. You can use <u>react-app-rewired</u> or <u>craco</u>, both of which have been standard ways to extend Create React App applications for several versions now. In the case of craco there is even a <u>Module</u> <u>Federation plugin that is available </u>to make it even easier and we will use that in this chapter as well.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">In this chapter there are four applications that you can use as starting points.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><ul id="l2"><li style="padding-left: 26pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">Host <span class="p">- This is a Create React App (CRA) that uses react-app-rewired to modify the Webpack configuration and it consumes components from the other applications.</span></p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 32pt;text-align: left;"><p class="s6" style="display: inline;">Search <span class="p">- This is a CRA application that uses craco to modify the Webpack</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 16pt;text-align: left;">configuration and has a function that reads all the files from a given directory and</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 14pt;text-align: left;">exposes them. This functionality can be used in any context.</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Checkout <span class="p">- This is a CRA app that uses craco and the craco-module-federation</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 14pt;text-align: left;">plugin to configure the application to share a component.</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Carousel <span class="p">- This is a create-mf-app based application that is shown here to</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 16pt;text-align: left;">demonstrate interoperability with the CRA applications.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">Let’s go through each of the applications one by one.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">HOST APP USING REWIRED</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="73" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_039.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">We build the host application using standard create react app in the packages directory:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">% <b>cd packages</b></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">% <b>yarn create react-app host</b></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_040.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">After that we add react-app-rewired using yarn:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">% yarn add react-app-rewired -D</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_041.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Then we alter the package.json scripts like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;scripts&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;start&quot;: &quot;<b>PORT=3000 react-app-rewired </b>start&quot;, &quot;build&quot;: &quot;<b>react-app-rewired </b>build&quot;,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;test&quot;: &quot;<b>react-app-rewired </b>test&quot;, &quot;eject&quot;: &quot;<b>react-app-rewired </b>eject&quot;</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">That will not only allow us to override parts of the Create React App configuration but also allow us to tweak the Webpack configuration. It also sets the port to 3000 so that its reliably at that port number.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="482" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_042.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">The final step is to create a new <span class="s5">config-overrides.js </span>file, like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const ModuleFederationPlugin = require(&quot;webpack/lib/container/ ModuleFederationPlugin&quot;);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const deps = require(&quot;./package.json&quot;).dependencies; module.exports = function override(config) {</p><p class="s11" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">config.output.publicPath = &quot;auto&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">if (!config.plugins) { config.plugins = [];</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">config.plugins.unshift(</p><p class="s11" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;home&quot;,</p><p class="s11" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">...</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">})</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return config;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The critical pieces here are to set the <span class="s5">publicPath </span>appropriately and to add the <span class="s5">ModuleFederationPlugin </span>with your desired settings. We use <span class="s5">unshift </span>here to make sure that the plugin is the first along the line of plugins (which is an extensive list).</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: justify;">In the <u>example code </u>we configure the ModuleFederationPlugin to remote in all of the other applications and to export a <span class="s5">Container </span>component as well as a <span class="s5">Header </span>and a <span class="s5">Footer</span>.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 156%;text-align: left;">This set of applications use <u>styled-components </u>to expose components that manage their own CSS. A very common question around Module Federation (an Micro- Frontends more broadly) is how to manage CSS. You cannot federated CSS files directly. You can only federate JavaScript. So a CSS-in-JS solution, like <span class="s5">styled- components</span>, is an excellent way to share components that have self-contained styling.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Don’t Forget To Bootstrap</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">As with any application that uses Module Federation you have to bootstrap the application, and we have do that to all of the applications in the example code. If you don’t do this your application will fail to boot and complain in the console about not being able to eagerly load a dependency.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_043.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">The fix for this is straightforward. Copy the contents of <span class="s5">src/index.js </span>to a new file named <span class="s5">src/realIndex.js </span>(or whatever you choose). Then replace src/index.js with:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import(&quot;./realIndex&quot;);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s that easy. What this does is give Webpack some “breathing room” to be able to asynchronously load any dependencies required by Module Federation.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">SEARCH APP USING CRACO</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">Another way to modify a CRA application to do Module Federation is to use craco. We start by first create a fresh CRA application named search. Then we add <span class="s5">@craco/ craco </span>as a development dependency.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_044.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">From there we need to alter the <span class="s5">package.json </span>to run <span class="s5">craco </span>instead of <span class="s5">react- scripts </span>like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;scripts&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;start&quot;: &quot;PORT=3001 craco start&quot;, &quot;build&quot;: &quot;craco build&quot;,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;test&quot;: &quot;craco test&quot;, &quot;eject&quot;: &quot;craco eject&quot;</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This runs the application, with craco overrides, on port 3001.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="722" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_045.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">We specify the overrides in a craco.config.js file, shown below:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const ModuleFederationPlugin = require(&quot;webpack/lib/container/ ModuleFederationPlugin&quot;);</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">...</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const exposeDirectory = (dirName) =&gt; fs.readdirSync(dirName).reduce((exposes, file) =&gt; {</p><p class="s11" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">exposes[`./${file.replace(/[.].*$/, &quot;&quot;)}`] = `${dirName}/${file}`; return exposes;</p><p class="s11" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}, {});</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">module.exports = { webpack: {</p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">configure: (config) =&gt; { config.output.publicPath = &quot;auto&quot;;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: -14pt;line-height: 128%;text-align: left;">if (!config.plugins) { config.plugins = [];</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">config.plugins.unshift(</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">new ModuleFederationPlugin({</p><p class="s11" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">...</p><p class="s11" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">exposes: exposeDirectory(&quot;./src/federated&quot;),</p><p class="s11" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">...</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">})</p><p class="s11" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">return config;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">With craco you return an object and within that object you provide a key for <span class="s5">webpack</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">where, among other things, you can provide a <span class="s5">configure </span>function like we have here.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">In that configuration function we added the <span class="s5">ModuleFederationPlugin</span>, just like we did with <span class="s5">react-app-rewired</span>. Though in this case we used a cool <span class="s5">exposeDirectory </span>function to expose all of the modules located within a specific directory. In this case that’s <span class="s5">src/federated</span>. This means that any file located in <span class="s5">src/ federated </span>will automatically be exposed.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The straight forward exposeDirectory function answers another common Module Federation question; “How do I expose an entire directory of modules?” As you can see it’s pretty easy to do, but it’s not a feature that is built into Webpack.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">CHECKOUT USING CRACO-MODULE-FEDERATION</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 159%;text-align: left;">Another option to use Module Federation with CRA is to use <span class="s5">craco </span>and the <span class="s5">craco- module-federation </span>plugin. The checkout application in the example code was built using this method. We created the application using Create React App and added <span class="s5">craco </span>as above. But we also added <span class="s5">chaco-module-federation </span>as a development dependency.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="194" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_046.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">After altering the scripts in <span class="s5">package.json </span>to run <span class="s5">craco </span>instead of <span class="s5">react-scripts</span>, we create the <span class="s5">craco.config.js </span>file that contains:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">module.exports = { plugins: [</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">plugin: require(&quot;craco-module-federation&quot;),</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">],</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This just registers the plugin with <span class="s5">craco</span>, so now we have to configure it in</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">modulefederation.config.js<span class="p">, like so:</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_047.png"/></span></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">const deps = require(&quot;./package.json&quot;).dependencies; module.exports = {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">name: &quot;checkout&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">What the plugin does for us is automatically register the ModuleFederationPlugin. The configuration of that plugin is left to us to build out using this configuration file.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that you’ve got your first experience with Module Federation it is time to dig into the details of how to share code between applications safely. And that starts with a deep dive into the world of sharing React components.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.4</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark8">HOW MODULE FEDERATION WORKS</a><a name="bookmark9">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_048.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that we understand where Module Federation fits into the world, and we’ve tried it out on a very basic application, let’s increase our depth of knowledge by exploring how Module Federation works.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Let’s first look at how Module Federation works at build time.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">BUILD TIME</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 152%;text-align: left;">The <span class="s5">ModuleFederationPlugin </span>we’ve been using thus far is really just syntactic sugar over three interrelated plugins - it serves as a convenience plugin that passes options to the separated parts that perform the heaving heavy lifting. And you can use each of those individually and customize how you see fit so that you have ultimate control over the output.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">These three plugins are:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p></li><li style="padding-left: 26pt;text-indent: -17pt;text-align: left;"><p style="display: inline;"><b>ContainerPlugin </b>- This plugin manages the export the remote modules that you define in the <span class="s5">exposes </span>key of the configuration. It also creates the remote entry file</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 150%;text-align: left;">that acts as a manifest for the application, which is called the “scope” internally. If your application only exposes remote modules then this is the only plugin you need. This is what a remote uses.</p><ul id="l3"><li style="padding-top: 1pt;padding-left: 33pt;text-indent: -17pt;text-align: left;"><p style="display: inline;"><b>ContainerReferencePlugin </b>- This plugin manages the <span class="s5">remotes </span>in the configuration. This is what a host uses.</p></li><li style="padding-left: 33pt;text-indent: -17pt;line-height: 31pt;text-align: left;"><p class="s6" style="display: inline;">SharePlugin <span class="p">- This plugin manages the shared portion of the configuration. It</span></p><p style="padding-left: 33pt;text-indent: 0pt;line-height: 16pt;text-align: left;">handles all of the versioning requirements for the shared packages. Shared is also</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 33pt;text-indent: 0pt;line-height: 150%;text-align: left;">referred to as “overrides” both internally and externally. This use used by both remote and host.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_049.png"/></span></p><p style="padding-left: 16pt;text-indent: 0pt;line-height: 158%;text-align: left;">To get a deeper look at what’s built by Webpack a good way to do that is run the build in development mode and to look at the output of the <span class="s5">dist </span>directory, like this:</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 16pt;text-indent: 0pt;text-align: left;">webpack —mode development</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 16pt;text-indent: 0pt;line-height: 157%;text-align: left;">In an example project that exposes one remote module, <span class="s5">Header</span>, the example output is shown below:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><table style="border-collapse:collapse;width:561pt;margin-left:5pt" cellspacing="0"><tr><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#D6D5D5;border-left-style:solid;border-left-width:1pt;border-left-color:#D6D5D5"><p style="text-indent: 0pt;line-height: 11pt;text-align: left;"><br/></p><p class="s17" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">Asset</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#D6D5D5" colspan="2"><p style="text-indent: 0pt;line-height: 11pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 36pt;text-indent: 0pt;text-align: left;">Size</p></td><td style="border-top-style:solid;border-top-width:1pt;border-top-color:#D6D5D5" colspan="4"/></tr><tr><td style="border-left-style:solid;border-left-width:1pt;border-left-color:#D6D5D5"><p class="s17" style="padding-top: 1pt;padding-right: 6pt;text-indent: 0pt;text-align: right;">index.html</p></td><td colspan="2"><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">171 bytes</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[compared</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">for</p></td><td style="border-right-style:solid;border-right-width:1pt;border-right-color:#D6D5D5"><p class="s17" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">emit]</p></td><td/></tr><tr><td><p class="s17" style="padding-top: 1pt;padding-right: 6pt;text-indent: 0pt;text-align: right;">main.js</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">2.93</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">KiB</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[emitted]</p></td><td/><td/><td><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[name: main]</p></td></tr><tr><td><p class="s17" style="padding-top: 1pt;padding-left: 154pt;text-indent: 0pt;text-align: left;">remoteEntry.js</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">12.1</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">KiB</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[emitted]</p></td><td/><td/><td><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[name: nav]</p></td></tr><tr><td><p class="s17" style="padding-top: 1pt;padding-left: 142pt;text-indent: 0pt;text-align: left;">src_header_js.js</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 18pt;text-indent: 0pt;text-align: left;">2.3</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">KiB</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[emitted]</p></td><td/><td/><td/></tr><tr><td><p class="s17" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">vendors-node_modules_react_index_js.js</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">73.7</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">KiB</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[compared</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">for</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">emit]</p></td><td><p class="s17" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[id hint: vendors]</p></td></tr><tr><td><p class="s17" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">Entrypoint main = main.js</p></td><td/><td/><td/><td/><td/><td/></tr><tr><td style="border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#D6D5D5"><p class="s17" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">Entrypoint nav = remoteEntry.js</p></td><td style="border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#D6D5D5"/><td style="border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#D6D5D5"/><td style="border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#D6D5D5"/><td style="border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#D6D5D5"/><td style="border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#D6D5D5"/><td style="border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#D6D5D5"/></tr></table><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">Each of these files and its role is individually described below.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p></li><li style="padding-left: 33pt;text-indent: -17pt;text-align: left;"><p style="display: inline;"><b>index.html </b>- This is the compiled HTML file that includes the <span class="s5">main.js </span>file which runs the application.</p></li><li style="padding-left: 33pt;text-indent: -17pt;line-height: 31pt;text-align: left;"><p class="s6" style="display: inline;">main.js <span class="p">- The compiled code for the main entry point for the application.</span></p></li></ul></li></ul></li><li style="padding-top: 1pt;padding-left: 22pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">remoteEntry.js <span class="p">- The manifest Javascript </span>and specialized runtime <span class="p">for the exported remote modules and any shared packages.</span></p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 33pt;text-align: left;"><p style="display: inline;"><b>src_header_js.js </b>- The compiled Javascript for the <span class="s5">Header </span>component. This is</p><p style="padding-top: 3pt;padding-left: 22pt;text-indent: 0pt;line-height: 15pt;text-align: left;">referenced in the <span class="s5">remoteEntry.js </span>file.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 35pt;text-align: left;"><p class="s6" style="display: inline;">vendors-node_modules_react_index_js.js <span class="p">- The compiled react package that</span></p><p style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">supports the <span class="s5">Header </span>component which is shared.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s important to understand that these files are a fusion of the Javascript bundles required to run the application itself as well as the Javascript bundles required for the remote modules. And often times those two overlap. For example, the same vendor bundles that are referenced by the remote modules are used by the application itself.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now that the Javascript is all compiled, let’s discuss how it actually works at runtime.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">MODULE FEDERATION AT RUNTIME</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">When the <span class="s5">remoteEntry.js </span>is loaded by the browser it registers a global variable with the name specified in the library key in the <span class="s5">ModuleFederationPlugin </span>configuration. This variable has two things in it, a <span class="s5">get </span>function that returns any of the remote modules, and an <span class="s5">override </span>function that manages all of the shared packages.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">For example you have an Application with the name of <span class="s5">nav </span>that exposes a runtime module named <span class="s5">Header</span>. After loading the code you would be able to open up the console and inspect <span class="s5">window.nav </span>and see that it has two functions, <span class="s5">get </span>and <span class="s5">override</span>.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_050.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">With the <span class="s5">get </span>function we can get the <span class="s5">Header</span>, like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">window.nav.get(&#39;Header&#39;)</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_051.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This returns a promise, which when resolved gives you a factory. We can invoke that like this:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">window.nav.get(&#39;Header&#39;).then(factory =&gt; console.log(factory()));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">This will output through <span class="s5">console.log </span>the module as defined in the <span class="s5">Header </span>implementation. If Header exports a <span class="s5">default </span>the the value returned from <span class="s5">factory() </span>will be an object with a key named <span class="s5">default</span>. If the module has other named exports those will also be attached to the object.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 159%;text-align: left;">A side effect of running the factory is also to load any shared packages required by the remote module. Webpack is good about only loading the shared packages required to support each module. For example, if component A imports <span class="s5">react </span>and <span class="s5">lodash</span>, but component B only imports <span class="s5">react</span>, running the factory on B would only bring in <span class="s5">react</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">In addition, Module Federation is smart enough to resolve shared packages between remotes. For example, a host application named <span class="s5">host </span>consumes two remotes: <span class="s5">nav </span>and <span class="s5">search</span>. Both <span class="s5">nav </span>and <span class="s5">search </span>require <span class="s5">lodash</span>, but <span class="s5">host </span>does not. Whichever remote is loaded first will load its version of <span class="s5">lodash</span>, and if the other remote module is loaded, it will use the already loaded <span class="s5">lodash </span>as long as its version parameters are satisfied.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="296" height="77" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_052.png"/></span></p><p class="s6" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Important Note: <span class="p">Circular imports and nested remotes are supported. For example App A imports a module from App B, App B imports an exported module from App C, which imports an expose module from App A. This is pictured in the diagram below.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><table style="border-collapse:collapse;width:80pt" cellspacing="0"><tr><td style="border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" rowspan="2"><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s18" style="padding-left: 13pt;text-indent: 0pt;text-align: left;">App A</p></td><td style="border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:2pt"/></tr><tr><td style="border-top-style:solid;border-top-width:2pt;border-left-style:solid;border-left-width:1pt"/></tr></table><p class="s19" style="padding-top: 3pt;padding-left: 257pt;text-indent: 0pt;text-align: left;">App B                App C</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Webpack will resolve these circular imports correctly and efficiently.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that we’ve dug more deeply into Module Federation and how it works we will jump back into the world of practical implementation and cover how to safely deploy our federated modules.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.5</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark10">DEPLOYING FEDERATED MODULES</a><a name="bookmark11">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_053.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_054.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_055.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">A very common question around Module Federation is; “This is really cool, but how do I deploy it?” Let’s answer that question in this chapter.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">BUILDING FOR PRODUCTION</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 155%;text-align: left;">The first thing you need to know when you are going to production is the base URL from where you are going to serve the JavaScript bundles. This is important because Webpack loads your federated modules at runtime using URLs that are constructed relative to the <span class="s5">publicPath </span>defined in the configuration. Where we set the publicPath to <u>http://localhost:3000/ </u>in development mode we might set it to <u>https://</u> <u>assets.mycompany.com/carousel </u>if this is the <span class="s5">carousel </span>project (just an example.)</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_056.png"/></span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Once we know where we are deploying to now we just need to change the webpack configuration when we are building for production. But how do build for production? We would do something like:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">webpack --mode production</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s8" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">And that will send the p<span class="p">roduction argument to the Webpack configuration</span>.                       </p><p style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that we know we are in production mode how do we switch the configuration based on that?</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="362" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_057.png"/></span></p><p style="padding-left: 6pt;text-indent: 0pt;text-align: left;">We can turn the <span class="s5">webpack.config.js </span>from an object into a function like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 6pt;text-indent: 0pt;line-height: 128%;text-align: left;">const HtmlWebPackPlugin = require(&quot;html-webpack-plugin&quot;); const ModuleFederationPlugin = require(&quot;webpack/lib/container/ ModuleFederationPlugin&quot;);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 6pt;text-indent: 0pt;line-height: 128%;text-align: left;">const deps = require(&quot;./package.json&quot;).dependencies; module.exports = <b>(env, argv) =&gt; (</b>{</p><p class="s10" style="padding-left: 34pt;text-indent: -14pt;line-height: 128%;text-align: left;">output: { publicPath:</p><p class="s11" style="padding-left: 49pt;text-indent: 0pt;text-align: left;">argv.mode === &quot;production&quot;</p><p class="s11" style="padding-top: 3pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">? &quot;https://assets.mycompany.com/carousel&quot;</p><p class="s11" style="padding-top: 3pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">: &quot;http://localhost:3000/&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">}<b>)</b>;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 0pt;line-height: 161%;text-align: left;">Then we can use <span class="s5">argv.mode </span>to point the publicPath (which is the value that we set to let Webpack know where it’s deploying) based on whether the <span class="s5">mode </span>is <span class="s5">production </span>or not.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_058.png"/></span></p><p style="padding-left: 6pt;text-indent: 0pt;text-align: left;">You can also do this automatically by specifying <span class="s5">publicPath </span>as <span class="s5">auto</span>, like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">output: {</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;text-align: left;">publicPath: &quot;auto&quot;,</p><p style="text-indent: 0pt;text-align: left;"><span><img width="111" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_059.png"/></span></p><p class="s10" style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="197" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_060.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="314" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_061.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">The remotes section is not so easy, however. We can’t just use auto. So we can use the same logic over in the remotes section to define where the remote code is located, like so:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s10" style="padding-left: 77pt;text-indent: -14pt;line-height: 128%;text-align: left;">carousel: `carousel@<b>${ argv.mode === &quot;production&quot; ?</b></p><p class="s11" style="padding-left: 91pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;https://assets.mycompany.com/carousel&quot; : &quot;http://localhost:3000&quot;</p><p class="s11" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">}<span class="s10">/remoteEntry.js`,</span></p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">...</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This code switches the remote based on whether we are building the host application in either production or development mode.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">This does raise an interesting question though about what to do when the code is being run in development mode. Maybe you want to test your development code against the production remotes? If so you’ll probably want some additional logic that looks at other arguments, for example <span class="s5">argv.remotes </span>where you can set that to <span class="s5">production </span>as well.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 158%;text-align: left;">There is a <u>sample project in the production directory </u>of this chapter’s GitHub code that is set up to demonstrate switching between development and production modes. First install the dependencies by running <span class="s5">yarn </span>in the root directory. To run in development mode run <span class="s5">yarn start </span>in the top level directory. To build for production mode run</p><p class="s5" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">yarn build<span class="p">, and </span>yarn serve <span class="p">to run in production mode. With this sample project the production code is located on port 8081, where the development code is on 3001.</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHERE SHOULD FEDERATED MODULES GO?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Federated modules are just JavaScript files, and as such should be deployed to an asset service like Amazon’s S3 service. Serving the files directly from an Express server, or any other kind of server is a waste of server processing power and money. If you have access to a Content Distribution Network (CDN) like Akamai Cloudfront you can use that to further optimize the delivery of the JavaScript assets.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">EXTERNAL REMOTES</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s not unusual to have three (or more) different environments. For example; development, test, and production. Where the test environment has a complete copy of the production environment with test data. In some companies it’s required that exactly the same built code runs in both test and production. This can be a problem for Module Federation because the remote URLs are stored in the built bundle. So if you build for a test deployment URL you would need to rebuild for production.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: left;">To get around this you can use the <span class="s5">external-remotes-plugin </span>which allows you to replace portions of the remote URLs at runtime. To see this in action there is an <u>example project </u>in the chapter’s code on GitHub. In this project there are two Micro- Frontends; MFE1 and MFE2, but both are built with the same federation name “mfe” so they can be used interchangeably by just pointing at either the <span class="s5">remoteEntry.js </span>file on port 3000 or 3001 depending on if you want MFE1 or MFE2 respectively.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="194" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_062.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The host application has the <span class="s5">external-remotes-plugin </span>installed and adds it to the list of plugins in the Webpack configuration.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">mfe: &quot;<b>mfe@[mfeUrl]/remoteEntry.js</b>&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_063.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">The <span class="s5">[mfeUrl] </span>in the brackets will be replaced by a value named <span class="s5">mfeUrl </span>on the window object at load time. To make use of this feature the main <span class="s5">index.js </span>file gets a little more complicated:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">fetch(&quot;/public/config.json&quot;)</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">.then((res) =&gt; res.json())</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">.then((config) =&gt; { <b>window.mfeUrl = config.mfeUrl; </b>import(&quot;./App&quot;);</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">We first fetch some data from a <span class="s5">config.json </span>file located in and served from the public directory.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">The config file looks like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;mfeUrl&quot;: &quot;http://localhost:3001&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_064.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">So in this case it sets the <span class="s5">mfeUrl </span>on window to be port 3001 on localhost, which is MFE2. So now when the application loads the MFE if will load MFE2. You can change this to 3000 and see it load from MFE1 <b>without rebuilding the bundle</b>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Of course, in your environment you’ll probably want to get the value for your external remotes using either a service or by inspecting the current URL.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that we’ve taken module federation to production, let’s talk more about how to make shared code and components safer in production.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.6</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark12">RESILIENT SHARING OF REACT COMPONENTS</a><a name="bookmark13">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_065.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_066.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_067.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 164%;text-align: left;">Let’s visualize the connection between the <span class="s5">host </span>app and the <span class="s5">nav </span>app we created in the last chapter. The <span class="s5">host </span>app has a runtime connection to the <span class="s5">Header</span>.</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="padding-left: 146pt;text-indent: 0pt;text-align: left;"><span><img width="361" height="85" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_068.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 157%;text-align: left;">But any runtime connection can be broken. So let’s try that out by simply starting the <span class="s5">host </span>server <i>without </i>running the <span class="s5">nav </span>app. The result is that the page is broken. No content is rendered at all.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="74" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_069.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">And in the console we see that <span class="s5">nav </span>is undefined:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Uncaught ReferenceError: nav is not defined</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">while loading &quot;Header&quot; from webpack/container/reference/nav</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Which is clearly not a great customer experience.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Let’s have a look at how reference the header in the code. We use a <span class="s5">React.lazy</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_070.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import and we’ve wrapped it in a Suspense:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense <i>fallback</i>={&lt;div /&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Apparently a suspense is not enough.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="554" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_071.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">What we need is an error boundary to make this system more resilient. To create an “error boundary” we follow the <u>documentation on the React site</u>, by adding a component to <span class="s5">host </span>application’s <span class="s5">App.jsx </span>file.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">class ErrorBoundary extends <i>React</i>.<i>Component </i>{ constructor(<i>props</i>) {</p><p class="s20" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">super<span class="s10">(props);</span></p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">this<span class="s10">.state = { hasError: false };</span></p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">static getDerivedStateFromError(<i>error</i>) { return { hasError: true };</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">componentDidCatch(<i>error</i>, <i>errorInfo</i>) {</p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">//  <span class="s10">logErrorToMyService(error, errorInfo);</span></p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">render() {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">if (<i>this</i>.state.hasError) {</p><p class="s10" style="padding-top: 3pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">return &lt;h1&gt;Something went wrong.&lt;/h1&gt;;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">return <i>this</i>.props.children;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="266" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_072.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">And then we wrap the <span class="s5">Suspense </span>in this new <span class="s5">ErrorBoundary </span>component.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;ErrorBoundary&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense <i>fallback</i>={&lt;div /&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/ErrorBoundary&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Hi there, I&#39;m React from React.&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s sad that we can’t use a hook for this, but unfortunately React does not currently support hooks for error boundaries. The good news is that the page renders and we get our error message instead.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 159pt;text-indent: 0pt;text-align: left;"><span><img width="304" height="216" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_073.png"/></span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: justify;">Which is certainly an improvement. But we could do better, and it starts by looking at the <span class="s5">ErrorBoundary </span>code. The important method is <span class="s5">getDerivedStateFromError </span>which is what creates the boundary. So let’s rewrite this <span class="s5">ErrorBoundary </span>component into a <span class="s5">FederatedWrapper </span>component that handles both the delayed execution case</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">covered by <span class="s5">React.Suspense </span>and the error case handled by</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">getDerivedStateFromError<span class="p">.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="386" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_074.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Shown below is the code for <span class="s5">FederatedWrapper </span>that handles both a slow load and an error during component execution.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">class FederatedWrapper extends <i>React</i>.<i>Component </i>{</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...// Same as in the ErrorBoundary class</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">render() {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">if (<i>this</i>.state.hasError) {</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">return <i>this</i>.props.error || &lt;div&gt;Something went wrong.&lt;/div&gt;;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense <i>fallback</i>={<i>this</i>.props.delayed || &lt;div /&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">{<i>this</i>.props.children}</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">And to use this wrapper component all you need to do is wrap the <span class="s5">Header </span>component in the <span class="s5">FederatedWrapper </span>with messaging alternatives for the <span class="s5">error </span>and <span class="s5">delay </span>properties.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_075.png"/></span></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;FederatedWrapper</p><p class="s20" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">error<span class="s10">={&lt;div&gt;Temporary Header&lt;/div&gt;}</span></p><p class="s20" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">delayed<span class="s10">={&lt;div&gt;Loading header...&lt;/div&gt;}</span></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;/FederatedWrapper&gt;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now this works and is resilient to multiple types of errors.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT HAPPENS WHEN THE APP GOES DOWN?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">A question we get asked a lot is “what happens when the apps go down”? This is a by- product of the fact that we most often demonstrate Module Federation by using two running applications. All of the assets, including the federated modules produced by the Module Federation plugin are shared by the Express server.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s really important to realize that federated modules are just JavaScript files. They have no connection to the application server. So whether the server is running or not should not effect their availability. In fact, they should be deployed as you would any other JavaScript file, to an asset store like <u>Amazon’s S3 service</u>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">A good way to conceptually think about federated modules, from the both the deployment and security angles, is as <i>fancy bundle splitting</i>. You deploy federated modules the same way you deploy your JavaScript bundles. And the security footprint of federate modules is the same as other JavaScript bundles.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">HIGH ORDER ERROR HANDLING</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="145" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_076.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Building on the FederatedWrapper we can create a high order component (HOC) that takes a lazy component and returns a component with the same API</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const wrapComponent = (<i>Component</i>) =&gt; ({ <i>error</i>, <i>delayed</i>, ...<i>props </i>}) =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;FederatedWrapper <i>error</i>={error} <i>delayed</i>={delayed}&gt;</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">&lt;Component {...props} /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/FederatedWrapper&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">This new <span class="s5">wrapComponent </span>function takes a React component as an argument and returns a new component that takes the properties for <span class="s5">error </span>and <span class="s5">delayed </span>and sends any additional properties onto the wrapped component.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_077.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This means that we can then create the Header component using this wrapper:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const Header = wrapComponent(React.lazy(() =&gt; import(&quot;nav/Header&quot;)));</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And use it in our application just as if we imported it directly.</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Hi there, I&#39;m React from React.&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_078.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This creates an API for our React components that we import via Module Federation that’s both easy to use, and resilient to errors.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">BOOTSTRAPPING  APPLICATIONS</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_079.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: justify;">Another important safety tip is to “bootstrap” your application. Bootstrapping means that your main entry point should be to a file whose job is to asynchronously load the main application. For example, you would have an <span class="s5">index.js </span>file, which is the main entry point for Webpack, and its contents would be:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import(&quot;./App&quot;);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="74" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_080.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And the local <span class="s5">App.jsx </span>file would have the application, like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">ReactDOM </span>from <span class="s10">&quot;react-dom&quot;;</span></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(&lt;div&gt;Hello world&lt;/div&gt;, document.getElementById(&quot;app&quot;));</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This “bootstrapping” gives Webpack the opportunity to process the rest of the imports before executing the app and will avoid potential race conditions on importing all the code.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="74" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_081.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">A non-bootstrapped version of this application would have an <span class="s5">index.js </span>file with the contents:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import ReactDOM from &quot;react-dom&quot;;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(&lt;div&gt;Hello world&lt;/div&gt;, document.getElementById(&quot;app&quot;));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">And since <span class="s5">index.js </span>is the main entry point of the application (which is the default for Webpack) then this code will execute immediately and not give Webpack any time to load the required remotes before execution.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_082.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">If this non-bootstrapped <span class="s5">index.js </span>were to contain a remote component, like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">import ReactDOM from &quot;react-dom&quot;; import Header from &quot;nav/Header&quot;;</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(&lt;Header /&gt;, document.getElementById(&quot;app&quot;));</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Then Webpack would not have the opportunity to load the nav remote before that code executes, and it would result in a runtime error.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">All of the examples in this book are bootstrapped.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">In the next chapter we discuss the different state sharing options available to you in federated React applications.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.7</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark14">REACT STATE SHARING OPTIONS</a><a name="bookmark15">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_083.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_084.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_085.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Once you have a way to share code between applications, whether that be through NPM modules or through Module Federation the inevitable next conversation that arises is how to share state between the host and the remote modules, or even between remotes. This chapter explores some options into how to share state.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">GETTING THE SETUP RIGHT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="122" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_086.png"/></span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 157%;text-align: left;">Let’s continue using the two example applications; <span class="s5">host </span>and <span class="s5">nav</span>, that we’ve been using thus far. And let’s experiment a little by removing the contents of the shared array  in  the  <span class="s5">ModuleFederationPlugin </span>configuration  in  <span class="s5">webpack.config.js</span>.  So that it would look like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">new ModuleFederationPlugin({</p><p class="s10" style="padding-top: 3pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">shared: {},</p><p class="s10" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">}),</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">Then restart the applications using <span class="s5">yarn start </span>and you’ll notice that it still works. Which is odd. We can even see the <span class="s5">react </span>library being imported along with the header in the browser’s network tab.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">But now let’s break this application by making one small change to the <span class="s5">Header</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">component.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="338" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_087.png"/></span></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import React from &quot;react&quot;; const Header = () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">const [stateIDontUse] = React.useState(null);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white&quot;&gt; I&#39;m the header!</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default Header;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The original <span class="s5">Header </span>was stateless, but now lets add some state by using a <span class="s5">useState</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">hook in the <span class="s5">Header.</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="194" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_088.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Looks good, but here is what we see in the console when it runs:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">Uncaught Error: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:</p><ol id="l4"><li style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;"><p class="s10" style="display: inline;">You might have mismatching versions of React and the renderer (such as React DOM)</p></li><li style="padding-left: 26pt;text-indent: -21pt;text-align: left;"><p class="s10" style="display: inline;">You might be breaking the Rules of Hooks</p></li><li style="padding-top: 3pt;padding-left: 26pt;text-indent: -21pt;text-align: left;"><p class="s10" style="display: inline;">You might have more than one copy of React in the same app</p></li></ol><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">This error is telling us what we already know; there are two <span class="s5">react </span>library instances on the page. But we didn’t get the error until we tried to use hooks, and that’s because hooks are internally stored as global state within the <span class="s5">react </span>library. So everything was fine until we used event the most basic hook, and boom, we got an error.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s important to understand this behavior, and the importance of sharing all of your runtime dependencies for this reason; any state sharing library is likely to have global state, or use features of the framework that require global state. You always need to share these libraries.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="362" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_089.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">To fix this we use this configuration when we share <span class="s5">react </span>and <span class="s5">react-dom</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const deps = require(&quot;./package.json&quot;).dependencies;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">shared: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">...deps, react: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">singleton: true, requiredVersion: deps.react,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 41pt;text-indent: -21pt;line-height: 128%;text-align: left;">&quot;react-dom&quot;: { singleton: true,</p><p class="s10" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">requiredVersion: deps[&quot;react-dom&quot;],</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">This defines <span class="s5">react </span>and <span class="s5">react-dom </span>as singletons which tells Webpack to make sure that there is never more than one copy of <span class="s5">react </span>or <span class="s5">react-dom </span>on the page at a time.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">With some understanding of how these libraries can go right and wrong, it’s time to dig into some specific state sharing options.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">USESTATE</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="481" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_090.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: justify;">The simplest and cleanest way to share state is to use <span class="s5">useState</span>. So let’s start with that and change the <span class="s5">host </span>app so that you can add items to a cart and the <span class="s5">Header </span>in <span class="s5">nav </span>so that it can display the count of items in the cart.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">const App = () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">const [itemCount, setItemCount] = useState(0); const onAddToCart = () =&gt; {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">setItemCount(itemCount + 1);</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">};</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div /&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10&quot;&gt;Hi there, I&#39;m some cool product.&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">className=&quot;px-5 py-2 bg-green-500 text-white rounded-xl&quot; onClick={onAddToCart}</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">&gt;Buy me!&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Cart count is {itemCount}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">This new version of the <span class="s5">App </span>component has its own state that contains a cart count.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">After pressing the “Buy me!” button five times the result in the browser looks like the figure below:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 140pt;text-indent: 0pt;text-align: left;"><span><img width="367" height="325" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_091.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_092.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And from here we can send this state onto the <span class="s5">Header </span>by adding a property:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;Header <i>count</i>={itemCount} /&gt;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="193" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_093.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And we can change the <span class="s5">Header </span>to display that value.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const Header = ({ count }) =&gt; { return (</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white flex&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;flex-grow&quot;&gt;Header - Cart count is {count}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 26pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">And the result is that we now have a <span class="s5">Header </span>from the <span class="s5">nav </span>application that tracks with the cart count state that’s stored in the <span class="s5">host </span>application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 153pt;text-indent: 0pt;text-align: left;"><span><img width="319" height="282" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_094.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_095.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">And now to make it bi-directional let’s pass through an <span class="s5">onClear </span>callback to enable the cart clearing button in the <span class="s5">Header</span>. So in the <span class="s5">host </span>application we change the <span class="s5">Header </span>component reference to:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;Header count={itemCount} onClear={() =&gt; itemCountSet(0)} /&gt;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now we are passing the onClear to the header.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_096.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">So we can change the <span class="s5">Header </span>implementation changes to:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">const Header = ({ <i>count</i>, <i>onClear </i>}) =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;header <i>style</i>={{ fontSize: &quot;xx-large &quot; }}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;span&gt;Header - Cart count is {count}&lt;/span&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;button <i>onClick</i>={onClear}&gt;Clear&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">And that completes the round circuit where have state store in the application that’s read and updated from a React component in a Federated Module.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">It’s not surprising this worked. This is the simplest and most straightforward way to share state in React. But it does provide a solid baseline to compare with some other approaches.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">USE-CONTEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Obviously prop-drilling is only going to get you so far, and it’s certainly no surprise that it works. But what about using a React context? That works as well and it provides an excellent setup for looking at other state managers like Redux, Mobx, Zustand, etc. since they use context as well.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">So let’s start with the <span class="s5">use-state </span>example code that we have to start and migrate that to a <u>use-context example </u>that uses React context to share state.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="289" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_097.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">The first thing to so is to create a shared <span class="s5">store </span>file in <span class="s5">packages/host/src/ store.js </span>like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 256%;text-align: left;">import React, { createContext, useContext, useState } from &quot;react&quot;; const CountContext = createContext(0);</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export const CountProvider = ({ children }) =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;CountContext.Provider value={useState(0)}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">{children}</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/CountContext.Provider&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export const useCount = () =&gt; useContext(CountContext);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 160%;text-align: left;">This is a pretty standard, if simplistic, context setup. We have two exported values, <span class="s5">CountProvider </span>which is a component that you use at the top of your tree to share the state down the tree. And <span class="s5">useCount </span>which is a custom hook that gives you the count and the count setter.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="314" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_098.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: justify;">The next thing we need to do is augment the Webpack configuration in <span class="s5">packages/ host/webpack.config.js </span>to both add the host (ourselves) as a remote and also share the store.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;my-nav&quot;: &quot;nav@http://localhost:3001/remoteEntry.js&quot;,</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">host: &quot;host@http://localhost:3000/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;./store&quot;: &quot;./src/store&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">shared: { ... },</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: justify;">Why are we adding ourselves as a remote? Because we want both the <span class="s5">host </span>and <span class="s5">nav </span>applications to look at the same instance of the <span class="s5">store </span>module, and importing both through the remote ensures that we will.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="650" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_099.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Now we alter the <span class="s5">packages/host/src/App.jsx </span>file to both provide and use the context.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">import React, { useState } from &quot;react&quot;; import ReactDOM from &quot;react-dom&quot;;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import Header from &quot;my-nav/Header&quot;;</p><p class="s11" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import { CountProvider, useCount } from &quot;host/store&quot;;</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import &quot;./index.scss&quot;; const App = () =&gt; {</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">const [itemCount, setItemCount] = useCount();</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">const onAddToCart = () =&gt; { setItemCount(itemCount + 1);</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">};</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;CountProvider&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">&lt;App /&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/CountProvider&gt;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">document.getElementById(&quot;app&quot;)</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">We start at the bottom by providing the context down the tree. Then in the <span class="s5">App </span>component we use the new <span class="s5">useCount </span>custom hook to get the current state value and state setter. And we can also remove the drilled properties from the header.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Now over in the nav project we need to update the Webpack configuration, located in</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="290" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_100.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">pacakges/nav/webpack.config.js<span class="p">, to add the </span>host <span class="p">application as a remote:</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;nav&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s11" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">host: &quot;host@http://localhost:3000/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;./Header&quot;: &quot;./src/Header&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">shared: { ... },</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now that we have access to the host as a remote we can update the <span class="s5">Header</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">component.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="386" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_101.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">We navigate over to <span class="s5">packages/nav/src/Header.jsx </span>and alter the code to use the count context:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import React from &quot;react&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import { useCount } from &quot;host/store&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const Header = () =&gt; {</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">const [count, setCount] = useCount();</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white flex&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;flex-grow&quot;&gt;Header - Cart count is <b>{count}</b>&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button onClick=<b>{() =&gt; setCount(0)}</b>&gt;Clear&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default Header;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">This works, but now the <span class="s5">Header </span>embedded in the <span class="s5">App </span>component of the nav application no longer works because we don’t have the context.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">So let’s add the <span class="s5">CountProvider </span>to the <span class="s5">App </span>component as well:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="266" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_102.png"/></span></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import { CountProvider } from &quot;host/store&quot;; const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;CountProvider&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10&quot;&gt;Nav project&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/CountProvider&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">And now both applications work just fine and communicate through the shared context. Cool, right?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">Now that we know we can share context this way we can start looking at using more complex state managers. But before we get into that, lets talk about some alternatives when it comes to sharing the <span class="s5">store </span>module because the current model we will using works fine for a single application, but probably won’t scale up cleanly to multiple host applications.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">SHARING STORES</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">As we saw in the <span class="s5">use-context </span>example the <span class="s5">host </span>application exposed a store, and the nav application consumed it.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 113pt;text-indent: 0pt;text-align: left;"><span><img width="452" height="134" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_103.png"/></span></p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">So why is that important? In the case of our <span class="s5">use-context </span>implementation you have to share the same <i>instance </i>of the module because it’s the instance that holds the global context for the state.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Of course, scaling this particular sharing architecture up could be problematic if we had multiple applications that could provide the store. So we could go with something like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 155pt;text-indent: 0pt;text-align: left;"><span><img width="316" height="180" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_104.png"/></span></p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Where we have shell federated module that holds the store and is referenced by any application that needs it or wants to provide it.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">For simplicity sake we will be using having the host application provide the store in the different scenarios that follow. But you should pick the state sharing setup that is most appropriate to your architecture.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">REDUX</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="122" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_105.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 153%;text-align: left;">If you’ve done any React you’ve heard of Redux, it’s easily the most commonly used state manager. To see how Redux works in the Module Federation context we start with simple project we finished in the Getting Started chapter. From there we add the Redux Toolkit   @<span class="s5">reduxjs/toolkit </span>and <span class="s5">react-redux </span>to <span class="s5">host </span>and <span class="s5">nav </span>applications.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">% cd packages/host</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% yarn add @reduxjs/toolkit react-redux</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% cd ../nav</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% yarn add @reduxjs/toolkit react-redux</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now we have Redux installed. And we can build our store.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">That means creating a <span class="s5">packages/host/store.js </span>file that looks like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="602" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_106.png"/></span></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import { configureStore, createSlice } from &quot;@reduxjs/toolkit&quot;; const counterSlice = createSlice({</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">name: &quot;counter&quot;, initialState: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">count: 0,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">reducers: {</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">increment: (state) =&gt; { state.count += 1;</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">clear: (state) =&gt; { state.count = 0;</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">});</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">export const { increment, clear } = counterSlice.actions; export const store = configureStore({</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">reducer: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">counter: counterSlice.reducer,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">This very simple Redux store has an initial state with a <span class="s5">count </span>of zero. And there are two actions, <span class="s5">increment</span>, will add one to the count, and <span class="s5">clear </span>will set the count to zero.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The next thing we want to do is to share the store externally (more about this later).</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_107.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Let’s add the store to the Webpack config like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 32pt;text-indent: 0pt;text-align: center;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: center;">&quot;./store&quot;: &quot;./src/store&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_108.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Our next step is to import and add a <span class="s5">Provider </span>to the application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">{ Provider, connect } </span>from <span class="s10">“react-redux&quot;;</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">{ store, increment } from &quot;host/store&quot;;</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And we then change the <span class="s5">ReactDOM.render </span>invocation to wrap our <span class="s5">App </span>in a</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_109.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Provider <span class="p">with the store .</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;Provider <i>store</i>={store}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: center;">&lt;App /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">&lt;/Provider&gt;, document.getElementById(&quot;app&quot;)</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">This is a critical step because this <span class="s5">Provider </span>is how we are going to get the state to any of the consumers. The big question is whether it will work from the <span class="s5">host </span>application through Module Federation into the <span class="s5">nav </span>app.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="506" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_110.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Before we get there we need to adjust the <span class="s5">App </span>React component to use this store.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const App = () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">const count = useSelector((state) =&gt; state.counter.count); const dispatch = useDispatch();</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div /&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10&quot;&gt;Hi there, I&#39;m some cool product.&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">className=&quot;px-5 py-2 bg-green-500 text-white rounded-xl&quot; onClick={() =&gt; dispatch(increment())}</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Buy me!</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Cart count is {count}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">Modern Redux uses the <span class="s5">useSelector </span>hook to get the state values we are interested in, and the <span class="s5">useDispatch </span>hook to get a dispatch function that we can use to dispatch actions.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="242" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_111.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">The only thing left to do is update the <span class="s5">Header </span>so that it connects to the store properly. That starts with allowing the nav app to see the store by adjusting its Webpack configuration.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;nav&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">host: &quot;host@http://localhost:3000/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;./Header&quot;: &quot;./src/Header&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Now we can access the store in the <span class="s5">host </span>application. This means that at this point <span class="s5">host </span>depends on <span class="s5">nav </span>for the <span class="s5">Header </span>component and <span class="s5">nav </span>depends on <span class="s5">host </span>for the Redux store. That’s fine. That’s a bi-directional connection and Module Federation supports that just fine.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="458" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_112.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">So let’s head over to the nav application and alter the <span class="s5">App.jsx </span>file to look like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import React from &quot;react&quot;;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 256%;text-align: left;">import { useSelector, useDispatch } from &quot;react-redux&quot;; import { clear } from &quot;host/store&quot;;</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const Header = () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">const count = useSelector((state) =&gt; state.counter.count); const dispatch = useDispatch();</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white flex&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;flex-grow&quot;&gt;Header - Cart count is {count}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button onClick={() =&gt; dispatch(clear())}&gt;Clear&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default Header;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">And this works just fine. Turns out that you can access your Redux store seamlessly in React components integrated using Module Federation.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">ZUSTAND</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="73" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_113.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;"><u>Zustand </u>is a popular alternative Redux that has a similar level of structure to a Redux store but has far less boilerplate. Let’s try it out by starting with our <span class="s5">use-context </span>implementation and adding in the <span class="s5">zustand </span>library to the host application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">% cd packages/host</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% yarn add zustand</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">In this case we don’t need to add <span class="s5">zustand </span>to the nav app because as long as we have the custom hook that Zustand creates we are good to go.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="194" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_114.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The next thing we need to do is change the <span class="s5">packages/host/src/store.js </span>file to read:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import create from &quot;zustand&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">export const useCount = create((set) =&gt; ({ count: 0,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">increment: () =&gt; set((state) =&gt; ({ count: state.count + 1 })), clear: () =&gt; set((state) =&gt; ({ count: 0 })),</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">}));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">I’m joking, right? This is a store? Not joking, no. And yes, this is a Zustand store. You have the values at the top, in this case <span class="s5">count</span>, then the methods you want. And the methods just call set to set the state. How cool is that! No wonder folks love Zustand.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="434" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_115.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">Now the next thing we need to do is use that over in the <span class="s5">packages/host/src/ App.jsx </span>file:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">import React, { useState } from &quot;react&quot;; import ReactDOM from &quot;react-dom&quot;;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import Header from &quot;my-nav/Header&quot;;</p><p class="s11" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import { useCount } from &quot;host/store&quot;;</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import &quot;./index.scss&quot;; const App = () =&gt; {</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">const { count, increment } = useCount();</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p class="s11" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(&lt;App /&gt;, document.getElementById(&quot;app&quot;));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">We also get to take the context out because all you need is the new <span class="s5">useCount </span>custom hook that was created by Zustand.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="386" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_116.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">To complete the migration we need to go over to the <span class="s5">packages/nav/Header.jsx </span>file and update the code over there.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import React from &quot;react&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import { useCount } from &quot;host/store&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const Header = () =&gt; {</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">const { count, clear } = useCount();</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white flex&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;flex-grow&quot;&gt;Header - Cart count is {<b>count</b>}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button onClick={<b>clear</b>}&gt;Clear&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default Header;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">You can check out the complete setup for yourself in the <u>example code associated with</u> <u>this chapter</u>. I think you’ll come away impressed with just how easy Zustand is to use. You can use Zustand both within the React context and outside of the React context as well. It also works very well with asynchronous workflows.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">MOBX</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="122" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_117.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">Mobx is another popular state manager for React applications. It works an observables model. To try out Mobx in Module Federation we first need to install it in both the <span class="s5">host </span>and <span class="s5">nav </span>applications.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">% cd packages/host</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% yarn add mobx mobx-react</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% cd ../nav</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% yarn add mobx mobx-react</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">Then we create the store, which is as easy as adding this code to a new <span class="s5">packages/ host/store.js </span>file:</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="194" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_118.png"/></span></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import { observable } from &quot;mobx&quot;; const store = observable({</p><p class="s20" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">count: 0,</p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default store;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">We then pass the store to the <span class="s5">App </span>component by re-writing the <span class="s5">ReactDOM.render</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_119.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">invocation.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(&lt;App <i>store</i>={cartStore} /&gt;, document.getElementById(&quot;app&quot;));</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="530" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_120.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">And then to finish the implementation of the <span class="s5">App </span>we wrap it an <span class="s5">observer</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import { observer } from &quot;mobx-react&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">...</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const App = observer(() =&gt; { return (</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div /&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;Header store={store} /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10&quot;&gt;Hi there, I&#39;m some cool product.&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">className=&quot;px-5 py-2 bg-green-500 text-white rounded-xl&quot; onClick={<b>() =&gt; (store.count += 1)</b>}</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Buy me!</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Cart count is {store.count}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">We’ve removed the state from <span class="s5">App </span>and now we just use the <span class="s5">count </span>as a regular Javascript object. To set it all we need to do is just set its value and the observable handles all the rest. We also need to send the store to <span class="s5">Header </span>as a property.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="338" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_121.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">Then over in the <span class="s5">Header </span>implementation in the <span class="s5">nav </span>application we also wrap that in an  <span class="s5">observer</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import React from &quot;react&quot;;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import { observer } from &quot;mobx-react&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const Header = () =&gt; { return (</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white flex&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;flex-grow&quot;&gt;Header - Cart count is {store.count}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button onClick={() =&gt; (store.count = 0)}&gt;Clear&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default observer(Header);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Once again, we display the data simply by showing the value. And we reset the value just by setting it to zero. And this all works seamlessly across these components brought together through Module Federation.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 158%;text-align: left;">The reason all this works is because we are sharing the same instance of the observable from the <span class="s5">store </span>exposed by the <span class="s5">host </span>application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">RECOIL</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">Recoil is a novel state management system from FaceBook that is designed to extend the existing <span class="s5">useState </span>and <span class="s5">useContext </span>mechanisms by providing state that is “orthogonal to the rendering tree”. Meaning that <span class="s5">useState </span>and <span class="s5">useContext </span>relate directly to where they are used in the React tree. When <span class="s5">useState </span>or <span class="s5">useContext</span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">change anything below where they are defined in the React tree will be re-rendered. Recoil on the other hand stores its state as “atoms” that are held apart from the tree. So when an atom changes state then only those components that are using it will re- render.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Let’s try it out and you can see more of what I mean. The first step is to install <span class="s5">recoil</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="122" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_122.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">in both the <span class="s5">host </span>and <span class="s5">nav </span>applications.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">% cd packages/host</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% yarn add recoil</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% cd ../nav</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% yarn add recoil</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">With that done we can launch the servers with <span class="s5">yarn start</span>. We then create a new file in the <span class="s5">src </span>directory of the home <span class="s5">app </span>called <span class="s5">atoms.js </span>with these contents.</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_123.png"/></span></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import { atom } from &quot;recoil&quot;; export const cartCount = atom({</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">key: &quot;cartCount&quot;, default: 0,</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This creates a new “atom” that holds the cart count value. In the recoil model state is stored as atoms and components subscribe to those atoms. If an atoms value changes then any component that subscribes to it will be updated. You can have as many atoms as you like. And you can use another mechanism called a “selector” to create composite atoms from a collection of other atoms.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="74" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_124.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">To use the <span class="s5">cartCount </span>atom we return to the <span class="s5">App.jsx </span>file and import both recoil and the atoms:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">{ useRecoilState, RecoilRoot } </span>from <span class="s10">&quot;recoil&quot;;</span></p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">{ cartCount } </span>from <span class="s10">&quot;./atoms&quot;;</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">We then wrap the <span class="s5">App </span>component in a <span class="s5">RecoilRoot </span>as part of our</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_125.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render<span class="p">.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(</p><p class="s10" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">&lt;RecoilRoot&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 10pt;text-indent: 0pt;text-align: center;">&lt;App /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">&lt;/RecoilRoot&gt;, document.getElementById(&quot;app&quot;)</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Next we change <span class="s5">useState </span>to <span class="s5">useRecoilState </span>and point it at the <span class="s5">cartCount </span>atom.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="578" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_126.png"/></span></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import { cartCount } from &quot;host/atoms&quot;; const App = () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">const [itemCount, setItemCount] = useRecoilState(cartCount); const onAddToCart = () =&gt; {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">setItemCount(itemCount + 1);</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">};</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div /&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10&quot;&gt;Hi there, I&#39;m some cool product.&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">className=&quot;px-5 py-2 bg-green-500 text-white rounded-xl&quot; onClick={onAddToCart}</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Buy me!</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Cart count is {itemCount}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 160%;text-align: left;">One of the great things about Recoil is how it’s almost a plug and play replacement for <span class="s5">useState</span>. What do you do if more than one component need the state? Make an atom and point both components at it by just replacing <span class="s5">useState </span>with <span class="s5">useRecoilState</span>. It’s very clean.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="194" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_127.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">Notice that the <span class="s5">Header </span>now no longer has any properties. So to make that work we first need to export the atoms from home by altering the <span class="s5">webpack.config.js</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">new ModuleFederationPlugin({</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">“./atoms&quot;: &quot;./src/atoms&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Then over in the <span class="s5">nav </span>application new need to alter the <span class="s5">webpack.config.js </span>to add</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="193" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_128.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">host <span class="p">as a remote.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">new ModuleFederationPlugin({</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">remotes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">Host: &quot;host@http://localhost:3000/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">This is creating a bi-directional linkage between <span class="s5">host </span>and <span class="s5">nav </span>so that we can share the same instance of the atoms. Just as we have shared the same instance of the store in previous examples.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="410" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_129.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">To finish the example we use the <span class="s5">useRecoilState </span>hook to both get and set the value of the <span class="s5">cartCount </span>atom:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import React from &quot;react&quot;;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 256%;text-align: left;">import { useRecoilState } from &quot;recoil&quot;; import { cartCount } from &quot;host/atoms&quot;;</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const Header = () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">const [itemCount, setItemCount] = useRecoilState(cartCount); return (</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white flex&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;flex-grow&quot;&gt;Header - Cart count is {itemCount}&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button onClick={() =&gt; setItemCount(0)}&gt;Clear&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default Header;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">And it’s as easy as that. When the user clicks on the button the atom is updated and all the consumers of the atom are updated automatically.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">RXJS</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">RxJS is a very popular event bus library. It’s not often used as a state mechanism, but there is no reason why it can’t be done.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Let’s try it out and you can see it in action. The first step is to install <span class="s5">rxjs </span>in the <span class="s5">host</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="73" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_130.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">% cd packages/host</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">% yarn add rxjs</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="74" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_131.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The next thing to do is to import Subject from <span class="s5">rxjs </span>and to create a <span class="s5">Subject </span>that will hold the cart count.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">import { Subject } from “rxjs&quot;; const count = new Subject(0);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">Subjects in RxJS are event busses. And in this case we are starting the topic off with the value of zero. You can post a new value by using the <span class="s5">next </span>method on the object. And you can subscribe to the bus by calling to <span class="s5">subscribe </span>method.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="506" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_132.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">To integrate it with the <span class="s5">App </span>component in the <span class="s5">App.jsx </span>file in home we will first create a new custom React hook called <span class="s5">useSubject</span>. It’s defined like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const useSubject = (subject, initialValue) =&gt; { const [value, valueSet] = useState(initialValue);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">useEffect(() =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">const sub = subject.subscribe(valueSet); return () =&gt; {</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">sub.unsubscribe();</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">};</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}, [subject]);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">return [ value,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">increment: () =&gt; count.next(value + 1), clear: () =&gt; count.next(0),</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">];</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export const useCount = () =&gt; useSubject(count, 0);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">This hook takes the subject and its initial value and uses a standard <span class="s5">useState </span>to hook to track its state. It then subscribes to that subject and updates the state any time it changes.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Passing in the <span class="s5">intialValue </span>is a hack because we didn’t use a <span class="s5">BehaviorSubject </span>that can return the most recently posted value at any time. There are several different types of subjects each with different semantics. I chose <span class="s5">Subject </span>because it’s the simplest type and I wanted to show that it works with the simplest possible contract.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="458" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_133.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">So, now that we have our hook we can use it in the <span class="s5">App </span>component.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const App = () =&gt; {</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">const [count, { increment }] = useCount();</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div /&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10&quot;&gt;Hi there, I&#39;m some cool product.&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">className=&quot;px-5 py-2 bg-green-500 text-white rounded-xl&quot;</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">onClick={increment}</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Buy me!</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Cart count is <b>{count}</b>&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: justify;">We use the <span class="s5">useCount </span>hook we just created to get the current value of items in the cart. And then we use the <span class="s5">next </span>method on the count subject to increase its value, or set it to zero in the case of the <span class="s5">clear</span>.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="386" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_134.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: justify;">Now we could just send <span class="s5">itemCount </span>to the <span class="s5">Header</span>, but instead let’s send the subject so that it too can subscribe to it. To do that we change <span class="s5">Header.js </span>in the nav project. The result is shown in the code fragment below:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import React from &quot;react&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import { useCount } from &quot;host/store&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const Header = () =&gt; {</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">const [count, { clear }] = useCount();</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;header className=&quot;text-5xl font-bold p-5 bg-blue-500 text-white flex&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;flex-grow&quot;&gt;Header - Cart count is <b>{count}</b>&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;button onClick={<b>clear</b>}&gt;Clear&lt;/button&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/header&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default Header;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">And we reuse the same <span class="s5">useCount </span>code from <span class="s5">host</span>, which is critical because we have to share the same instance of the subject to get the state sharing to work.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Using RxJS as an Analytics Bus</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Another, probably more appropriate use of RxJS would be for something like an analytics bus. Where any component could post events to the bus that would then be sent to an analytics service.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_135.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">To set that up we first create a new file in <span class="s5">host </span>named <span class="s5">analytics.js </span>with these contents:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">import { Subject } from “rxjs&quot;; const analyticsBus = new Subject(); export default analyticsBus;</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_136.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The next step is to expose that file (module) in the <span class="s5">webpack.config.js</span>:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;./analytics&quot;: &quot;./src/analytics&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_137.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">That allows us to import it using the name <span class="s5">host</span>, like this in App.jsx.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import analyticsBus from &quot;home/analytics&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">It’s important that we import it by referring to home to ensure that both the <span class="s5">App</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">component and the <span class="s5">Header </span>component get exactly the same analytics subject.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_138.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now that we have it imported we can attach a console function to it using subscribe.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">analyticsBus.subscribe((evt) =&gt; { console.log(`analytics: ${JSON.stringify(evt)}`);</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="338" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_139.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">Next we can start to instrument our code, like the <span class="s5">increment </span>and <span class="s5">clear </span>function from <span class="s5">useSubject </span>which now sends out analytics messages:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">return [ value,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">increment: () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">analyticsBus.next({ type: &quot;addToCart&quot;, value: value + 1 }); count.next(value + 1);</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">clear: () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">analyticsBus.next({ type: &quot;onClear&quot; }); count.next(0);</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">];</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Using RxJS for an analytics event bus in a way that’s more in-line with its original purpose. It also opens up the opportunity to put loggers, filters, mutations and much more into the bus to work the analytics events in whatever way you please. RxJS provides a lot of tooling for that.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">HOW TO CHOOSE</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The choice of a state manager is highly dependent on the type of application you are building. But here are some recommendations.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: left;">For applications that will be using Module Federation to bring in code to extend the existing interface, like a customer extensible dashboard, then using a conventional <span class="s5">useState </span>approach with property drilling and well defined callbacks. This provides the safest and most well-defined interface without additional package requirements.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">For an internal dashboard, where the modules will pick and choose between a variety of data then recoil seems like an interesting solution because it would limit the re- renders to just those components subscribed to the specific atom that is being updated.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">An e-Commerce application, or any application that has very limited data sharing requirements (user identity, cart contents, etc.) between federated modules using either a few Recoil atoms or a small Redux store would work well.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">There are many state managers in the React ecosystem and this chapter has only covered a few. If you are starting with a new project you should develop a set of requirements and then evaluate and run proof of concepts of several solutions so you can evaluate how well they match your requirements and how the developer experience feels.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">Module Federation is about sharing more than components and state, any type of Javascript can be shared. In the next chapter we cover multiple techniques to add resilience to any type of function or data that’s shared by Module Federation.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.8</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark16">RESILIENT FUNCTION AND STATIC DATA SHARING</a><a name="bookmark17">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_140.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_141.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_142.png"/></span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 45pt;text-indent: 0pt;line-height: 150%;text-align: left;"><b>Important Note: </b>In the previous chapters we have followed a walkthrough style of teaching Module Federation concepts. From this chapter on we will be walking through the completed applications available to you in the <u>GitHub repository</u>. You are strongly encouraged to use these projects as a starting point for your own work where you can experiment and see how to suit the code to meet your own needs.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">One of the most unique and important aspects of Module Federation is that you can share anything that can be represented as a Javascript module. This includes:</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><ul id="l5"><li style="padding-left: 26pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Primitives <span class="p">- Numbers, strings, Dates, etc.</span></p><h4 style="padding-left: 9pt;text-indent: 0pt;line-height: 24pt;text-align: left;">-<span class="s21"> </span><span class="s6">Arrays</span></h4></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p class="s6" style="display: inline;">Objects <span class="p">- From regular objects to JSON that’s transpiled by Babel</span></p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p class="s6" style="display: inline;">Functions <span class="p">- And not just React component functions</span></p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 30pt;text-align: left;"><p class="s6" style="display: inline;">Classes <span class="p">- Which are really just functions, but need to be invoked with new</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">To emphasize this point we’ll walk through some examples and show how they are exported and consumed, and also show different ways to manage them safely.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">THE LOGIC PROJECT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="337" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_143.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">To experiment with different types of modules to federate we’ve created an application named logic that exposes modules with several different types of signatures. The <span class="s5">webpack.config.js </span>exposes all of these relevant files.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;logic&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;./analyticsFunc&quot;: &quot;./src/analyticsFunc&quot;, &quot;./arrayValue&quot;: &quot;./src/arrayValue&quot;, &quot;./classExport&quot;: &quot;./src/classExport&quot;, &quot;./objectValue&quot;: &quot;./src/objectValue&quot;, &quot;./singleValue&quot;: &quot;./src/singleValue&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">shared: {},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This is then consumed by a <span class="s5">home </span>project that works with the different types of data.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">PRIMITIVE VALUES</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Let’s start with the simplest case, the single value. Looking at the <span class="s5">singleValue.js</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_144.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">file we see it implemented as just a default return of a string.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default &quot;single value&quot;;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">But that single value could be any primitive, a number, a boolean, whatever.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">In the <span class="s5">host </span>application we then consume it using an asynchronous <span class="s5">import </span>within a</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="290" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_145.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">useEffect <span class="p">hook that runs only once.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const SingleValue = () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">const [singleValue, singleValueSet] = React.useState(null);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">React.useEffect(() =&gt; { import(&quot;logic/singleValue&quot;)</p><p class="s10" style="text-indent: 0pt;text-align: center;">.then(({ default: <i>value </i>}) =&gt; singleValueSet(value))</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">.catch((<i>err</i>) =&gt; console.error(`Error getting single value: ${err}`));</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}, []);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">return &lt;div&gt;Single value: {singleValue}.&lt;/div&gt;;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">This code creates some state to hold the value using a <span class="s5">useState </span>hook. It then uses the <span class="s5">useEffect </span>hook to start the <span class="s5">import</span>. The <span class="s5">import </span>can either return successfully, in which case we get back an object with the <span class="s5">default </span>key that we map to <span class="s5">value </span>and then use to set the <span class="s5">singleValue</span>. In case of an error we send that error to the console.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">And at the end we render the result into a <span class="s5">&lt;div&gt; </span>tag in our application.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: left;">So what we are seeing is that importing values, of any type, just requires an asynchronous <span class="s5">import </span>to bring in safely. You can use synchronous imports in some cases, but to build a resilient code base you should import the code asynchronously and handle the case when you are unable to get the code you need.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Arrays and objects work exactly the same as the single value case and you can have a look at the book code to see this for yourself.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">FUNCTIONS</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_146.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It starts to get more interesting as we look at functions. Let’s take an example of an analytics sending function. The example code defines it like this:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default (<i>msg</i>) =&gt; console.log(`Analytics msg: ${msg}`);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_147.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">This is exported as <span class="s5">nav/analyticsFunc</span>. And we want to be able to run it at any time. The simplest alternative is to write a small wrapper function like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const analyticsFunc = import(&quot;logic/analyticsFunc&quot;); const sendAnalytics = (<i>msg</i>) =&gt; {</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">analyticsFunc</p><p class="s10" style="padding-top: 3pt;padding-left: 26pt;text-indent: 0pt;text-align: left;">.then(({ default: <i>analyticsFunc </i>}) =&gt; analyticsFunc(msg))</p><p class="s10" style="padding-top: 3pt;padding-left: 26pt;text-indent: 0pt;text-align: left;">.catch((<i>err</i>) =&gt; console.log(`Error sending analytics value: ${msg}`));</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Here is the interesting thing about promises, they will resolve immediately if the promise has already been resolved. So in this case you can send as many calls as you like to this function and once it resolves the first time it will unlock the rest and send everything out.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="218" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_148.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">If you want something more generic you can create a functor that takes an <span class="s5">import </span>with a function as the default and returns a function that you can call in the same way as  <span class="s5">sendAnalytics </span>above.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const createAsyncFunc = (<i>promise</i>) =&gt; (...<i>args</i>) =&gt; promise</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">.then(({ default: <i>func </i>}) =&gt; func(...args))</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">.catch((<i>err</i>) =&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">console.log(`Error sending value: ${JSON.stringify(args)}`)</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const sendAnalytics = createAsyncFunc(import(&quot;logic/analyticsFunc&quot;));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">This high order <span class="s5">createAsyncFunction </span>takes an asynchronous <span class="s5">import </span>promise and returns a function that takes whatever arguments you have and sends them to the function once it has resolved.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="602" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_149.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">If you want to queue up messages to the function until it resolves we can create a different high order function that maintains a queue of messages to go to the function before it resolves.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const queuedFunction = (<i>funcPromise</i>) =&gt; { let queueFunc = null;</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">const queue = []; let pending = false;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">return (<i>msg</i>) =&gt; { if (queueFunc) {</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">queueFunc(msg);</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">} else { queue.push(msg);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: -14pt;line-height: 128%;text-align: left;">if (!pending) { pending = true; funcPromise</p><p class="s10" style="padding-left: 91pt;text-indent: -14pt;line-height: 128%;text-align: left;">.then((<i>func</i>) =&gt; { queueFunc = func;</p><p class="s10" style="padding-left: 91pt;text-indent: 0pt;line-height: 128%;text-align: left;">queue.forEach(queueFunc); queue = [];</p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">})</p><p class="s10" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">.catch((<i>err</i>) =&gt; console.log(`Error getting queued function`));</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">};</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: justify;">This function takes an asynchronous <span class="s5">import </span>promise, just like the one above. But until it resolves it maintains a queue of messages that it then sends to the function using the <span class="s5">forEach</span>.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">To create the <span class="s5">sendAnalytics </span>function using this high order <span class="s5">queueFunction</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_150.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">functor you call it this way:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const sendAnalytics = queuedFunction( import(&quot;logic/analyticsFunc&quot;).then(({ default: <i>func </i>}) =&gt; func)</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">CLASSES</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="290" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_151.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The last thing to try out is a non-React class. The test class in the logic application is defined this way.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">class MyClass { constructor(<i>value</i>) {</p><p class="s20" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">this<span class="s10">.value = value;</span></p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">logString() {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">console.log(`Logging ${<i>this</i>.value}`);</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">export default MyClass;</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="194" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_152.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">To bring this into the home app we create a function called <span class="s5">newClassObject </span>that takes arguments and sends them to the constructor once we have it.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const classExport = import(&quot;logic/classExport&quot;); const newClassObject = (...<i>args</i>) =&gt;</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">classExport</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">.then(({ default: <i>classRef </i>}) =&gt; { return new <i>classRef</i>(...args);</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">})</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">.catch((<i>err</i>) =&gt; console.log(`Error getting class: ${err}`));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">This code starts the <span class="s5">import </span>and gets a promise back. It then creates a function that uses that promise and either throws an error if it catches or, if it works, returns a new object with the values it’s given as arguments.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_153.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">You invoke it and monitor it as a promise, as in the code below.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">newClassObject(&quot;initial value&quot;).then((<i>theObject</i>) =&gt; { theObject.logString();</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_154.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And the result is that you see in the console is:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Logging initial value</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Exciting stuff! But it does show that you can safely consume and create objects from classes exported from remote modules.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The fact that Module Federation can share any type of Javascript code opens up a world of possibilities for your projects. Here are some ideas for you:</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p></li></ul></li><li style="padding-left: 22pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">A/B testing code <span class="p">- Code for different test variants that you can load on the fly - using asynchronous imports</span></p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 26pt;text-align: left;"><p class="s6" style="display: inline;">Feature flags <span class="p">- Javascript objects containing feature flags or settings</span></p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p class="s6" style="display: inline;">i18n strings <span class="p">- The localization strings for different languages, lazily loaded</span></p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 30pt;text-align: left;"><p class="s6" style="display: inline;">Persistent state management <span class="p">- Javascript code to manage and store persistent</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">state in local storage on the client</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that we know how Module Federation works and how to export and import any kind of code safely, the next chapter will cover how to load Federated Modules dynamically.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.9</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark18">DYNAMICALLY LOADING FEDERATED MODULES</a><a name="bookmark19">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_155.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_156.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_157.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 161%;text-align: left;">So far the relationship between our host applications and our remotes has been fixed. For example the <span class="s5">host </span>page includes a reference to the <span class="s5">nav </span>app where it gets the remote <span class="s5">Header </span>module. But you don’t have to do this. You can dynamically load the <span class="s5">remoteEntry.js </span>onto the page and then execute your own version of <span class="s5">import </span>to run the code.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">The book code for this chapter has three directories;</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><ul id="l6"><li style="padding-left: 26pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">widget <span class="p">- This is a single React component that is shared as a remote module in the scope of widget and under the name Widget.</span></p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 32pt;text-align: left;"><p class="s6" style="display: inline;">host-wp5 <span class="p">- This is a host application, running on Webpack 5, that dynamically</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 14pt;text-align: left;">loads and runs widget.</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">host-wp4 <span class="p">- This is a host application, running on Webpack 4, that dynamically</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 16pt;text-align: left;">loads and runs widget.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">We’ll start with having a look at the <span class="s5">widget </span>directory and the <span class="s5">webpack.config.js</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="242" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_158.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">within that directory.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;widget&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&quot;./Widget&quot;: &quot;./src/Widget&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">shared: {...},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_159.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">The important elements here are that we export the <span class="s5">Widget </span>component and that the name of this application is widget. It’s also good so see that we are running and exporting this remote module off of port 8080.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">output: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">publicPath: &quot;http://localhost:8080/&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">devServer: { port: 8080,</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_160.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The React widget itself is super simple as shown in the code below.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">React </span>from <span class="s10">&quot;react&quot;;</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default () =&gt; &lt;div&gt;I&#39;m a cool widget&lt;/div&gt;;</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">You can spruce it up if you like. But for now it’s time to run <span class="s5">yarn start </span>in the</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">widget <span class="p">directory and get the Webpack development server up and running.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">Over in the <span class="s5">host-wp5 </span>directory we have the host for the Widget remote module. If we have a look at its <span class="s5">webpack.config.js </span>we can see it only uses <span class="s5">ModuleFederationPlugin </span>to share <span class="s5">react</span>, other than that this is just a standard Webpack 5 configuration.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="674" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_161.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">The real action happens over in <span class="s5">App.jsx </span>where we define a new React component called <span class="s5">System </span>that loads the <span class="s5">remoteEntry.js </span>script, gets the code in the module and then renders it.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">function System(props) {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">const { ready, failed } = useDynamicScript({ url: props.system &amp;&amp; props.system.url,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">if (!props.system) {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">return &lt;h2&gt;Not system specified&lt;/h2&gt;;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">if (!ready) {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">return &lt;h2&gt;Loading dynamic script: {props.system.url}&lt;/h2&gt;;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">if (failed) {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">return &lt;h2&gt;Failed to load dynamic script: {props.system.url}&lt;/h2&gt;;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">const Component = React.lazy( loadComponent(props.system.scope, props.system.module)</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback=&quot;Loading System&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: center;">&lt;Component /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">The <span class="s5">useDynamicScript </span>hook is a custom React hook that, given a URL, in this case for the <span class="s5">remoteEntry.js</span>, adds a script tag to the page and then sets ready to <span class="s5">true </span>when the script is loaded (or failed to true if that failed).</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">After that, we use <span class="s5">React.lazy </span>and React.Suspense as we have in many other examples in this book. However, where we would normally use an asynchronous <span class="s5">import() </span>statement, we are instead using <span class="s5">loadComponent</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">This function is doing what import does. It’s using the scope (widget) and module (Widget) to get the module factory from the globally mounted object. Then it invokes that factory and returns the module. This is just what <span class="s5">React.lazy </span>wants to see.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 153%;text-align: left;">The reason that <span class="s5">react </span>is called out in particular is that React is a singleton that requires that there is only a single instance on the page at a time. So this code initializes the scope with the host pages React library instance so that the widget module avoids loading its’ own version.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The result when we run yarn start in the <span class="s5">home-wp5 </span>directory (while the server is also running in widget) looks like this.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 127pt;text-indent: 0pt;text-align: left;"><span><img width="391" height="244" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_162.png"/></span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It might not look like much, but when combined with all of the potential types of code and visual components that we can use with Module Federation, the potential for what we can do if we load code from anywhere is astonishing.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">However, what happens if you aren’t on Webpack 5. Can you still do this?</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">CONSUMING FEDERATED MODULES FROM WEBPACK 4</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s great that we can consume federated modules on Webpack 5, but Webpack is complex and sometimes migration can be an involved process. Can we use federated modules today even in Webpack 4? Absolutely!</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="145" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_163.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Looking at the <span class="s5">host-wp4 </span>directory and the <span class="s5">package.json </span>within that directory you can see that the Webpack version is currently 4.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;devDependencies&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;webpack&quot;: &quot;^4.43.0&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">And the <span class="s5">webpack.config.js </span>file for this project has no mention of module federation as it was not available in version 4.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">In the <span class="s5">src/App.jsx </span>file we can see the implementation for the host React component. It has the same <span class="s5">useDynamicScript </span>hook that we used in the Webpack 5 version just to get the code onto the page.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="674" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_164.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">The difference is in the <span class="s5">DynamicWidget </span>component that uses <span class="s5">useDynamicScript </span>to get the code and then uses the factory functionality to give <span class="s5">React.lazy </span>the <span class="s5">Widget </span>module to run.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const DynamicWidget = ({ <i>url</i>, <i>scope</i>, <i>module</i>, ...<i>props </i>}) =&gt; { const { ready, failed } = useDynamicScript(url);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">window[scope].override( Object.assign(</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">react: () =&gt; Promise.resolve().then(() =&gt; () =&gt; require(&quot;react&quot;)),</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">global. webpack_require<u>  </u></p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">)</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">? global. webpack_require .o : {}</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">const Component = React.lazy(() =&gt; window[scope].get(module).then((<i>factory</i>) =&gt; {</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">const Module = factory(); return Module;</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">})</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense <i>fallback</i>=&quot;Loading System&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;Component {...props} /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">The <span class="s5">React.lazy </span>and <span class="s5">React.Suspense </span>are basically the same as in the Webpack 5 example. The big difference is that we are manually setting the <span class="s5">overrides </span>for the</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">scope. We are telling with <span class="s5">widget </span>remote module that we already have <span class="s5">react </span>and  that it should use our version instead of downloading its own version. This part is critical because otherwise there would be two copies of React on the page and we would have issues as are described in detail in the React State Sharing chapter. All of your shared packages need to be listed in this <span class="s5">override </span>call.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="266" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_165.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Once that’s all set up we can bring in the <span class="s5">Widget </span>from the <span class="s5">widget </span>application just like any other React component.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: center;">&lt;div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">&lt;DynamicWidget url={&quot;http://localhost:8082/remoteEntry.js&quot;} scope={&quot;widget&quot;}</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">module={&quot;Widget&quot;}</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">/&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Hi there, I&#39;m React from React in Webpack 4.&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s a testament to the stability of the Webpack architecture that we can use cutting edge features from one version reliably in the previous version.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">In the next chapter we dig into how to share packages properly across federated modules.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.10</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark20">SHARED LIBRARIES AND VERSIONING</a><a name="bookmark21">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_166.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 154%;text-align: left;">If you take a look at any Javascript file in your application it’s probably going to start with at least a few, if not a lot, of <span class="s5">import </span>statements, many using node modules or packages. That’s just the nature of the Javascript ecosystem. But it does make for a challenge when we share code because the piece of code that brings in those imports needs those packages, and needs them at the right versions.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 157%;text-align: left;">This is why getting the shared key in the <span class="s5">ModuleFederationPlugin </span>right is so critical.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p></li><li style="padding-left: 26pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">Duplication <span class="p">- Without sharing the packages you get duplication and this will slow down the experience.</span></p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 32pt;text-align: left;"><p class="s6" style="display: inline;">Version mismatch <span class="p">- If we don’t get the sharing setup correctly then different</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 16pt;text-align: left;">remote modules could end up consuming incorrect versions which could lead to</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 14pt;text-align: left;">crashes.</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Singletons and internal state <span class="p">- Many libraries, particularly frontend libraries,</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 16pt;text-align: left;">have internal state that is required in order to run properly. That means there can</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;text-align: left;">only be one instance of that library running at a time. Which we call a “singleton”.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">This chapter walks through the different ways to configure the shared key with recommendations on when to use each of the different options.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">SPECIFYING VERSIONS</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="122" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_167.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">There are three ways to specify shared versions. The first is the array syntax we’ve been using thus far with the names of each of the libraries to share. The second is an object syntax with the name of the library as the key, and the version (using <u>semantic</u> <u>versioning format</u>) as the value. It looks like this:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;react&quot;: &quot;^16.12.0&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;react-dom&quot;: &quot;^16.12.0&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_168.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">If that looks familiar that’s because it looks exactly the same as it does in <span class="s5">package.json </span>and it works exactly the same way. In fact, because <span class="s5">webpack.config.js </span>is just a Javascript script you could do:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: require(&#39;./package.json&#39;).dependencies</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">That is perfectly valid and potentially even preferable since it automatically shares out any runtime dependencies with their versions.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">However, you can be even more precise about the control by using the third form where you hint Webpack in exactly how to manage the shared dependency.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">FALLBACK</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Webpack has a fallback behavior if the package provided as shared doesn’t match the requirements  specified  in  the  <span class="s5">ModuleFederationPlugin </span>or  <span class="s5">SharePlugin </span>configuration.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 160%;text-align: left;">Here is an example, both applications <span class="s5">A </span>and <span class="s5">B </span>consume <span class="s5">lodash </span>but at different versions. And both have copies of loads available to them as potential fallbacks. A loads first and bring in its own version (1.0) of <span class="s5">lodash</span>. <span class="s5">B </span>is starting to load and looking for <span class="s5">lodash </span>but requires a later version (2.0). With the right version hinting to Webpack the <span class="s5">B </span>remote module will “fall back” on its version of <span class="s5">lodash </span>because of that version mismatch.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This fallback feature enables versioning deployments at scale because not all applications will be required to push new versions at the same. time.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WEBPACK SHARING HINTS</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">There is another variant of the object syntax where the key is the name of the package and the value is another object containing different hints to modify the behavior of Webpack’s   <span class="s5">SharePlugin</span>.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_169.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">For example, this shared configuration.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;react&quot;: { singleton: true</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;react-dom&quot;: &quot;^16.12.0&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Will inform Webpack that react should be treated as a singleton, meaning that under  no loading circumstances should there ever be more than one copy of react running at a time.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The <span class="s5">react-dom </span>package however is packaged as normal using <u>semantic versioning</u> <u>(semver) rules</u>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The sections that follow detail the different hinting options you can send to Webpack’s <span class="s5">SharePlugin </span>through <span class="s5">ModuleFederationPlugin</span>, or directly, if you prefer that level of control.</p><p class="s23" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="145" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_170.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This is the import name of the package. Here is an example:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;react&quot;: { import: &quot;react&quot;</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">This will import the react package from the module reference <span class="s5">&quot;react&quot;</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s23" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">shareKey</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="146" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_171.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This is the name that will be used to identify the package within the scope. Here is an example:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;react&quot;: { shareKey: &quot;react&quot;</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">This will share the package the <span class="s5">&quot;default&quot; </span>scope under the key <span class="s5">&quot;react&quot;</span>.</p><p class="s23" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">shareScope</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="145" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_172.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This is the scope that will be used to store the shared package. Here is an example:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">&quot;react&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">shareScope: &quot;default&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">This will share the package the <span class="s5">&quot;default&quot; </span>scope under the key <span class="s5">&quot;react&quot;</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s23" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">singleton</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="146" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_173.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Toggles <span class="s5">singleton </span>status for this shared package. If <span class="s5">singleton </span>is truthy then only one instance of this package should be running at any time. Here is an example:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;react&quot;: { singleton: true</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">This enables the management of the <span class="s5">react </span>package as a singleton.</p><p class="s23" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">strictVersion</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="193" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_174.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">The <span class="s5">strictVersion </span>flag tells Webpack to use the fallback if there is no version match. If the singleton flag is enabled and there is no fallback then Webpack will throw an error . Here is an example:</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;react&quot;: { singleton: true,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">strictVersion: true, version: &quot;^16.12.0&quot;</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This configuration tells Webpack that react is a singleton and it must be in the specified semantic version of &quot;^16.12.0&quot;, and if nothing is available then fallback or throw.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s23" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">version</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="146" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_175.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The version of the package. Here is an example:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;react&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">version: &quot;^16.12.0&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This configuration tells Webpack that react should be used at the specified semantic version.</p><p class="s23" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">requiredVersion</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="145" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_176.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The version of the package that is required otherwise Webpack should use the fallback. Here is an example:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;shared&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;react&quot;: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">requiredVersion: &quot;^16.12.0&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This configuration tells Webpack that react must be used at the specified semantic version.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">As you can see a bunch of thought has gone into making a reliable versioning mechanism for shared packages in Module Federation.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Before we wrap on the basics of Module Federation lets take a look at how we can use Module Federation to power experiences using frameworks other than React.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">1.11</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark22">NON-REACT  VIEW  FRAMEWORKS</a><a name="bookmark23">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_177.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_178.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_179.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Module Federation is strongly associated with React and Micro-Frontends, but it’s just a mechanism for sharing JavaScript code, any type of JavaScript code including code for other frameworks.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">At the time of this writing we tested these frameworks and they were all compatible with Module Federation: <u>Angular </u>(all versions), <u>Inferno</u>, <u>Lit</u>, <u>Mithril</u>, <u>Preact</u>, <u>Solid-JS</u>, <u>Vue </u>(both 2 and 3). In addition of course you can federated Vanilla JS applications. In general most frameworks that use or are compatible with Webpack 5 can use Module Federation. Some static site generation systems, like <u>Astro</u>, are incompatible with it because they generate HTML and not JavaScript.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 157%;text-align: justify;">In the <u>example code associated with this chapter </u>there are example projects in Vue and Solid-JS. Both were generated using <span class="s5">npx create-mf-app </span>which gives you an option to generate applications using most of the frameworks listed above.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">THE VUE EXAMPLE</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 158%;text-align: left;">Vue is a very popular VDOM framework similar in architecture to React. In this example we have <span class="s5">host </span>and <span class="s5">remote </span>applications. The remote application share out one</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="146" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_180.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">component, named <span class="s5">Widget</span>, that we specify in <span class="s5">packages/remote/src/ Widget.vue </span>like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;template&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&lt;div class=&quot;p-5 text-white border-dashed ...”&gt; My Cool Remote widget</p><p class="s10" style="padding-left: 18pt;text-indent: 0pt;text-align: center;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;/template&gt;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="241" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_181.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">We then expose that widget in the <span class="s5">remote </span>application’s Webpack configuration:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;remote&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;./Widget&quot;: &quot;./src/Widget.vue&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">shared: require(&quot;./package.json&quot;).dependencies,</p><p class="s10" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This exports the component and creates the necessary <span class="s5">remoteEntry.js </span>file.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="242" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_182.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">We then reference that <span class="s5">remote </span>in the remote key within the <span class="s5">host </span>Webpack configuration.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s11" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">remote: &quot;remote@http://localhost:3001/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">shared: require(&quot;./package.json&quot;).dependencies,</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">You can name the <span class="s5">remote </span>application whatever you want of course, and have as many of them as you want.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="410" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_183.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Finally we import the Widget into the host application and use it.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;template&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div class=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Name: host&lt;/div&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;Widget /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;/template&gt;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;script&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import Widget from &quot;remote/Widget&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default {</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">components: { Widget,</p><p class="s11" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&lt;/script&gt;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s just that easy! I have to say this is just as easy, or maybe even easier because of the elegant simplicity of the Vue developer experience, when compared to sharing React components between applications.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">THE SOLID-JS EXAMPLE</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">Solid-JS is a very lightweight framework that uses “fine grained updates” to create wildly fast applications, nearing the speed of hand written Vanilla JS applications. Which is one reason why it’s so popular.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">We’ve created two applications in the example source code project using <span class="s5">create-mf- app</span>, they are named <span class="s5">host </span>and <span class="s5">remote </span>and the remote application shares a single</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="146" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_184.png"/></span></p><p class="s5" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Widget <span class="p">component from </span>packages/remote/src/Widget.jsx<span class="p">. The </span>Widget <span class="p">code looks like this:</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&lt;div class=&quot;p-5 text-white border-dashed ...”&gt; My Cool Remote widget</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="241" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_185.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Looks a lot like React, right? We then expose Widget using the <span class="s5">remote </span>application’s Webpack configuration like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;remote&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;./Widget&quot;: &quot;./src/Widget&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">shared: {...},</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This creates a remoteEntry.js manifest file.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">We can point to in the <span class="s5">host </span>application’s remote configuration value located in</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="266" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_186.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">packages/host/webpack.config.js<span class="p">.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s11" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">remote: &quot;remote@http://localhost:3001/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">exposes: {}, shared: {...},</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="218" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_187.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 158%;text-align: left;">And then we can consume it just as easily as we can any other Solid-JS component in the   <span class="s5">pacakges/host/src/App.jsx </span>file:</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s11" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import Widget from &quot;remote/Widget&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div class=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Name: host&lt;/div&gt;</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;Widget /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Now that is pretty slick, you have to admit!</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">We’ve learned in this chapter that it’s just as easy to federate code within non-React frameworks, in this case Vue and Solid-JS, as it to federate code between React applications.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">We strongly encourage you to try this out for yourself. The <span class="s5">create-mf-app </span>application builder is a fantastic way to just try out new frameworks, even if you aren’t playing around with Module Federation in the process.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that we have an understanding of the basics of Module Federation lets get on with seeing how it can be practically used in Part 2!</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><h1 style="padding-left: 32pt;text-indent: 0pt;line-height: 95pt;text-align: left;">P<span class="h2">ART  </span>T<span class="h2">WO</span></h1><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="721" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_188.png"/></span></p><h3 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">PRACTICAL USE CASES</h3><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">2.1</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark24">RESILIENT HEADER/FOOTER</a><a name="bookmark25">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_189.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_190.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="721" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_191.png"/></span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Code for this chapter is <u>available on GitHub</u>. There is also a <u>Blue Collar Coder video</u> associated with this practical use case.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 152%;text-align: left;">A very common architectural problem occurs in the move from a monolithic architecture where we have one big app with one huge frontend codebase, to a micro- site architecture where we have a bunch of smaller NodeJS applications. We gain the ability to release quickly and independently, but we lose code sharing. NPM is great but the process of getting a new NPM module rolled out and consumed is a huge source of friction. But some things absolutely must be shared, and chief among those is the shared <span class="s5">Header </span>and <span class="s5">Footer</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Ideally we want a shared <span class="s5">Header </span>and <span class="s5">Footer </span>system with these attributes:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p></li><li style="padding-left: 26pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">Live sharing <span class="p">- We want all the micro-sites to update the header at the same time.</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 14pt;text-align: left;">Otherwise we get an inconsistent user experience, or worse.</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Sharing without requiring version bumps <span class="p">- The ideal system would not</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 14pt;text-align: left;">require the micro-sites to re-deploy with every update.</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Safety and resilience <span class="p">- The header should be absolutely safe and never take down</span></p><p style="padding-left: 26pt;text-indent: 0pt;line-height: 16pt;text-align: left;">the applications that consume it.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">The great news is that Module Federation allows us to come up with a sharing architecture that fills all of these requirements.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">In this example we will build a React <span class="s5">Header </span>project that exports both an NPM module and a Module Federation build. We then have a <span class="s5">Home </span>page application that consumes both of these builds.</p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p><p style="padding-left: 93pt;text-indent: 0pt;text-align: left;"><span><img width="475" height="174" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_192.jpg"/></span></p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">The frontend code then uses the Module Federation build first, then if an error occurs, it falls back onto the NPM code which it loads lazily. The <span class="s5">Header </span>from Module Federation is exactly the same as the <span class="s5">Header </span>from NPM, which is aliased to <span class="s5">FallbackHeader  </span>in  the  <span class="s5">HeaderWrapper</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: left;">The only difference is that the <span class="s5">Header </span>from Module Federation and the one from NPM is that the Module Federation version is guaranteed to be up to date with the most recently released version (i.e. live sharing). Where the NPM version will be whatever version was imported the last time the <span class="s5">Home </span>page was built.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">A fun way to think about this approach is like pitons in rock climbing. Module Federation is the climbing up the rock, but the NPM build is like the piton that keeps your application from falling too far if your grip slips.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Now that we know what we are building let’s take a look at the <u>code for this chapter on</u> <u>Github</u>.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="194" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_193.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">The first place to look is in the <span class="s5">package.json </span>of the nav project located in <span class="s5">packages/nav </span>directory. This is the standard <span class="s5">package.json </span>we’ve used throughout this book, with small modifications in the package scripts and the addition of a main key.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;scripts&quot;: {</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;build&quot;: &quot;npm run build:mf &amp;&amp; npm run build:npm”, &quot;build:mf&quot;: &quot;webpack --mode production”, &quot;build:npm&quot;: &quot;babel src --out-dir build”,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;main&quot;: &quot;./build/index.js&quot;,</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Now the build creates both a <span class="s5">dist </span>directory that has the contents of the Module Federation build, but also a build directory that has the NPM build. The main key then points the NPM consumer at the babel transpiled <span class="s5">index.js </span>file.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="74" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_194.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The <span class="s5">index.js </span>file looks like this:</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">import <span class="s10">Header </span>from <span class="s10">“./Header&quot;; export { Header };</span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">And the <span class="s5">Header </span>implementation file is a very simple React component.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="242" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_195.png"/></span></p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">import React from &quot;react&quot;; const Header = () =&gt; (</p><p class="s20" style="padding-left: 19pt;text-indent: 0pt;line-height: 14pt;text-align: left;">&lt;div className=&quot;bg-green-800 text-white font-bold text-2xl p-4&quot;&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">New Header</p><p class="s20" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">export default Header;</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">In the <u>video associated with this code </u>we use the background color to differentiate between an older NPM build of the <span class="s5">nav </span>project and the current live Module Federation code.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">Now that we understand the <span class="s5">nav </span>project and the <span class="s5">Header </span>component we can look to the consuming home application located in <span class="s5">packages/home</span>. The first thing to understand is that the overall project here, located in the root <span class="s5">package.json</span>, is a workspaces project. So it’s managing the NPM linking between the <span class="s5">home </span>and <span class="s5">nav </span>projects.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="146" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_196.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">You can see this in the <span class="s5">package.json </span>of the <span class="s5">home </span>app which references the <span class="s5">nav </span>at version 1.0.0.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;dependencies&quot;: { &quot;nav&quot;: &quot;1.0.0&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;react&quot;: &quot;^17.0.2&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;react-dom&quot;: &quot;^17.0.2&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">To import the Module Federation version of the nav project the <span class="s5">webpack.config.js</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="241" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_197.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">in the <span class="s5">home </span>project has this <span class="s5">ModuleFederationPlugin </span>configuration.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;home&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s11" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&quot;mf-nav&quot;: &quot;nav@http://localhost:8081/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">exposes: {},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">shared: { ... }, // Shared React dependencies</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">The interesting part here is that we are importing the <span class="s5">nav </span>remote but we are aliasing it to <span class="s5">mf-nav </span>within this project. That way in the code we can actively decide whether we are referencing the NPM version of the <span class="s5">Header </span>or the Module Federation version of the  <span class="s5">Header</span>.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="74" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_198.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">In fact you can see that right away in the <span class="s5">src/App.jsx </span>file where we lazily import both versions of the <span class="s5">Header</span>, like so:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const FallbackHeader = React.lazy(() =&gt; import(&quot;nav/build/Header&quot;)); const Header = React.lazy(() =&gt; import(&quot;mf-nav/Header&quot;));</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">We lazily import both versions, but for different reasons. The <span class="s5">FallbackHeader</span>, which is sourced from the NPM library, is lazily loaded because we don’t want to bring in the NPM header unless the Module Federation version fails. The Module Federation <span class="s5">Header </span>is lazily loaded because a failure to do so would bring down the application if the <span class="s5">import </span>failed.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="290" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_199.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">The <span class="s5">HeaderWrapper </span>is a React class because a React “Error Boundary” cannot be a functional components. It has two jobs, first is to catch any errors, which is handled by this code:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">class HeaderWrapper extends <i>React</i>.<i>Component </i>{ constructor(<i>props</i>) {</p><p class="s20" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">super<span class="s10">(props);</span></p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">this<span class="s10">.state = { hasError: false };</span></p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">static getDerivedStateFromError() { return { hasError: true };</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">componentDidCatch() {}</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="362" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_200.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">This <span class="s5">render </span>function renders the two different versions based on whether or not there has been an error.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">render() {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">if (<i>this</i>.state.hasError) { return (</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense <i>fallback</i>={&lt;div&gt;Loading fallback header&lt;/div&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;FallbackHeader /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: center;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense <i>fallback</i>={&lt;div&gt;Header loading&lt;/div&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;Header /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: justify;">In the case of an error we lazily render the <span class="s5">FallbackHeader</span>, and otherwise we render the Module Federation <span class="s5">Header </span>(which may cause an error and trigger the rendering of the <span class="s5">FallbackHeader</span>).</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">To try this all out first run <span class="s5">yarn </span>and <span class="s5">yarn build </span>at the top level of the project. From there you can run <span class="s5">yarn start </span>in each of the packages directories; <span class="s5">home </span>and <span class="s5">nav</span>. To check resilience simply stop the <span class="s5">yarn start </span>process on the <span class="s5">nav </span>project to see the home application fall back onto the NPM version.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Module Federation also provides additional levels of fallbacks for the Module Federation code by offering an array of externals. If the first one fails the second will be tried and so on.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">2.2</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark26">A/B  TESTS</a><a name="bookmark27">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_201.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_202.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="721" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_203.png"/></span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Code for this chapter is <u>available on GitHub</u>. There is also a <u>Blue Collar Coder video</u> associated with this practical use case.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">There are plenty of places to start on your journey towards implementing Module Federation across your org, and one of those is using it to implement A/B tests, and a shared A/B test manager.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="621" height="247" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_204.png"/></span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">A/B tests are a way of seeing true customer preferences through data. You take two variations on the same piece of interface. In the case of the example code we are comparing two different image borders:</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Variant A has a blue border, and variation B has a green dashed border. In production this choice would be linked to some meaningful action, for example, clicking an “Adoption” button to start the adoption process.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">There are three parts to this system:</p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p></li></ul></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">A/B Test Code <span class="p">- The code that renders the different variations</span></p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 30pt;text-align: left;"><p class="s6" style="display: inline;">Test Manager <span class="p">- Some code, or a service, that picks which option the customer will</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">be presented to the customer</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Results Manager <span class="p">- This is the system that receives the analytics messages</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">indicating which choice the customer choose, tabulates the results and chooses a</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: left;">“winner” after a statistically significant number of results have been gathered.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">In this example we will be focused on the first two of these, the A/B test code and the test manager. In reality however, the test and results manager roles are most often filled by third party systems as services.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="362" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_205.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">We start off the example by looking at the <span class="s5">packages/home </span>directory which contains a React application. Within that project in the <span class="s5">src </span>directory are the <span class="s5">FrameA </span>and <span class="s5">FrameB </span>components, both of which look like this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">React </span>from <span class="s10">&quot;react&quot;;</span></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">export default ({ <i>src</i>, <i>style</i>, ...<i>props </i>}) =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Variant A:&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;img</p><p class="s20" style="padding-top: 3pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">src<span class="s10">={src} style={{</span></p><p class="s10" style="padding-top: 3pt;padding-left: 69pt;text-indent: 0pt;line-height: 128%;text-align: left;">...style, padding: &quot;1em&quot;,</p><p class="s10" style="padding-left: 69pt;text-indent: 0pt;text-align: left;">border: &quot;5px solid blue&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">}}</p><p class="s10" style="padding-top: 3pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">{...props}</p><p class="s10" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: center;">&gt;&lt;/img&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The <span class="s5">FrameA </span>and <span class="s5">FrameB </span>components only vary by the contents of the initial <span class="s5">&lt;div&gt;</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">tag and the styling around the image.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="73" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_206.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">In the host <span class="s5">App.jsx </span>component we first lazily load these components.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const FrameA = React.lazy(() =&gt; import(&quot;host/FrameA&quot;)); const FrameB = React.lazy(() =&gt; import(&quot;host/FrameB&quot;));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">We lazily load them because we don’t want to load the variation unless it’s going to be displayed. This isn’t a huge concern in this case since the components are pretty small. But in real world experiments the code sizes can be larger.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="288" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_207.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">We also load the <span class="s5">VariantChooser </span>from the <span class="s5">ab-manager </span>remote and invoke it like this:</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">VariantChooser </span>from <span class="s10">“ab-manager/VariantChooser&quot;;</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">&lt;VariantChooser <i><b>test</b></i><b>=“test1&quot; variations={{</b></p><p class="s11" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">a: FrameA, b: FrameB,</p><p class="s11" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}}</p><p class="s20" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">src<span class="s10">=“https://placedog.net/640/480?id=53&quot; </span>style<span class="s10">={{ width: 640, height: 480 }}</span></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">/&gt;</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">It’s the job of the <span class="s5">VariantChooser </span>to roll the dice to see which variation we get, then to render the correct variation from the <span class="s5">variations </span>property. While also sending along the additional props (i.e. <span class="s5">src </span>and <span class="s5">style</span>). The <span class="s5">test </span>property defines the name of the test we are running, and what the possible values are. In this case the name is <span class="s5">test1 </span>and the possible values are <span class="s5">&quot;a&quot; </span>and <span class="s5">&quot;b&quot;</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">Which brings us to the other project in this monorepo and that’s the <span class="s5">ab-manager </span>project which holds the list of available tests, and the <span class="s5">VariantChooser </span>implementation.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_208.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">In the <span class="s5">variants.js </span>file within <span class="s5">packages/ab-manager </span>we see the list of all of the possible tests and their corresponding variations:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">export default { test1: [&quot;a&quot;, &quot;b&quot;],</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="406" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_209.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">We then import that set of tests into the <span class="s5">VariantChooser </span>implementation:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">React </span>from <span class="s10">&quot;react&quot;;</span></p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">variants </span>from <span class="s10">&quot;ab-manager/variants&quot;;</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 26pt;text-indent: -21pt;line-height: 128%;text-align: left;">const chooseVariant = (<i>test</i>) =&gt; variants[test][Math.floor(Math.random() * variants[test].length)];</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">const VariantChooser = ({ <i>test</i>, <i>variant</i>, <i>variations</i>, ...<i>props </i>}) =&gt; { const [testVariant] = React.useState(variant || chooseVariant(test)); const Component = variations[testVariant];</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">return (</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense <i>fallback</i>={&lt;div&gt;Loading variant&lt;/div&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;Component {...props} /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">export default VariantChooser;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">At the top we bring in the variants. We then define a <span class="s5">chooseVariant </span>helper function which just picks a random item from the test supplied. The component uses that to choose the variant to hold it in the state. It then renders the variant within a suspense.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The import of the variants is interesting. We could have just imported the variants from</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">&#39;./variants&#39;<span class="p">, since it’s located in the same directory. But by using the </span>&#39;ab-</p><p class="s5" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 159%;text-align: left;">manager/variants&#39; <span class="p">version we are forcing the import to go through Module Federation. This ensures that </span>variants.js <span class="p">gets split out from the </span>VariantChooser.jsx <span class="p">code. And that makes </span>variants.js <span class="p">independently deployable. So it would be possible to push a new version of the ab-manager with only the tests changed.</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="314" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_210.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">To get all this working we set up Module Federation this way in the <span class="s5">ab-manager</span>:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">new ModuleFederationPlugin({</p><p class="s11" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">name: &quot;ab_mgr&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s11" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&quot;ab-manager&quot;: &quot;ab_mgr@http://localhost:8080/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;./VariantChooser&quot;: &quot;./src/VariantChooser&quot;, &quot;./variants&quot;: &quot;./src/variants&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">shared: { ... }, // Shared React dependencies</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">It’s interesting to notice that the federated modules package is defined as <span class="s5">ab_mgr </span>but we then alias the remote to <span class="s5">ab-manager</span>. This is because the name <span class="s5">&quot;ab_mgr&quot; </span>is actually used as Javascript variable and a minus is not valid within a Javascript variable. So we use the underscore instead.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">We also expose the <span class="s5">VariantChooser </span>and variants using the <span class="s5">exposes </span>key.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="314" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_211.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">If we look at the <span class="s5">webpack.config.js </span>file in the <span class="s5">packages/home </span>directory where the <span class="s5">home </span>application is located we see the import of the <span class="s5">ab-manager</span>:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;host&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: -7pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s11" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;ab-manager&quot;: &quot;ab_mgr@http://localhost:8081/remoteEntry.js&quot;, &quot;host&quot;: &quot;host@http://localhost:8080/remoteEntry.js&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}, exposes: {</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&quot;./FrameA&quot;: &quot;./src/FrameA&quot;,</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&quot;./FrameB&quot;: &quot;./src/FrameB&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">shared: { ... }, // Shared React dependencies</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">As well as the exposing of both of the <span class="s5">Frame </span>variations.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="73" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_212.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Specifying host, which is the current project, as a remote also allows us to bring in the Frame components using standard Module Federation imports:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const FrameA = React.lazy(() =&gt; import(&quot;host/FrameA&quot;)); const FrameB = React.lazy(() =&gt; import(&quot;host/FrameB&quot;));</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: justify;">To run this example run <span class="s5">yarn </span>and then <span class="s5">yarn start </span>in the root directory. That will launch both the <span class="s5">home </span>and <span class="s5">ab-manager </span>applications. You should then have a look at the network tab to see that the Webpack is only bringing in the required variation.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">In the <u>Blue Collar Coder video </u>that accompanies this chapter we also change the values in the <span class="s5">variants.js </span>file to demonstrate that you can push just the list of variations without having to update the code in order to specify a winning variant.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">2.3</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark28">LIVE PREVIEW BETWEEN APPLICATIONS</a><a name="bookmark29">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_213.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_214.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="721" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_215.png"/></span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Code for this chapter is <u>available on GitHub</u>. There is also a <u>Blue Collar Coder video</u> associated with this practical use case.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">In large enterprise settings its not uncommon at all that you will get a division between the customer facing portion of the site and the administration facing side of the site. And while that’s maybe fine from an organizational standpoint, it’s not great for code sharing, particular code that really should be shared. A decent example of that is when you have the customer facing portion of the site rendering some data that is administered by the admin team.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">When the administration pages want to preview the data as it would appear to the customer they can either iframe in the production site and patch the data through in a “preview mode”, or they can just maintain a second copy of the rendering code. But Module Federation provides a “third way” by making it easy for the customer facing team to share rendering code with the administration team, or vice versa. And to do that sharing live so that absolute fidelity is preserved between the customer facing site and the administration site. A win for everyone!</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">In our example system the CMS editor looks like the site pictured below:</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 93pt;text-indent: 0pt;text-align: left;"><span><img width="476" height="295" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_216.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And the corresponding page on the customer facing site looks like this:</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 94pt;text-indent: 0pt;text-align: left;"><span><img width="476" height="295" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_217.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Buddy is such a cute dog! Honestly, if you are looking for good placeholder images you should check out <u>placedog.net</u>.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">There are two applications in the example code for this; <span class="s5">cms-admin </span>and <span class="s5">home</span>. In this case the <span class="s5">cms-admin </span>application has both a shared content editor component, named <span class="s5">EmbedPage</span>, and a shared content viewer component, called <span class="s5">EmbedEditor</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">The CMS application does not use the <span class="s5">EmbedPage </span>and <span class="s5">EmbedEditor </span>components directly. Those are both wrapper components that connect to the REST API endpoint using CORS so that the requests can go to a different port.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">THE CMS APPLICATION</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 159%;text-align: left;">Both the <span class="s5">cms-admin </span>and <span class="s5">home </span>applications are derived from the getting started project. But the <span class="s5">cms-admin </span>project significantly alters the <span class="s5">webpack.config.js </span>to extend the <span class="s5">dev-server </span>with a REST API to support reading and writing JSON payloads that represent the different “pages” in the Content Management System (CMS).</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="266" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_218.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">The <span class="s5">ModuleFederationPlugin </span>configuration should be familiar by now though;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;cms&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s11" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">&quot;./EmbedPage&quot;: &quot;./src/EmbedPage&quot;, &quot;./EmbedEditor&quot;: &quot;./src/EmbedEditor&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">shared: { ... }, // Shared React dependencies</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="241" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_219.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">We can take a quick look at <span class="s5">EmbedPage </span>to see how it retrieves content from the server and then sends it on to the <span class="s5">Page </span>component for display.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import Page from &quot;./Page&quot;;</p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import { fetchPage } from &quot;./api&quot;;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const EmbedPage = ({ page }) =&gt; {</p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">const { data } = useQuery([&quot;getPage&quot;, { page }], () =&gt; fetchPage(&quot;http://localhost:8080&quot;)(page)</p><p class="s20" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s20" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">return data ? &lt;Page {...data} /&gt; : null;</p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">This <span class="s5">EmbedPage </span>component uses the excellent <span class="s5">react-query </span>library to connect to the CMS service defined in the Webpack configuration using an absolute URL.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And the underlying <span class="s5">Page </span>component is a straightforward content formatter:</p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">const Page = ({ title, text, img1, img2, img3 }) =&gt; (</p><p class="s20" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;h1 className=&quot;border-b-4 border-blue-700 text-4xl font-bold”&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">{title}</p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/h1&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;p className=&quot;mt-5&quot;&gt;{text}&lt;/p&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;grid grid-cols-3 gap-3 mt-5&quot;&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">{[img1, img2, img3].filter(Boolean).map((img) =&gt; (</p><p class="s20" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;img</p><p class="s20" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;line-height: 128%;text-align: left;">key={img} src={img}</p><p class="s20" style="padding-left: 54pt;text-indent: 0pt;text-align: center;">className=&quot;w-full h-full object-center ...”</p><p class="s20" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">))}</p><p class="s20" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s20" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="434" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_220.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">You could also share out <span class="s5">Page </span>from <span class="s5">cms-admin </span>for clients specifically interested in rendering without the data fetching. In the case of this example the <span class="s5">EmbedPage </span>makes it easier on the client with a simple contract; given a page name the component will make the necessary requests to show the page.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The rest of the <span class="s5">cms-admin </span>applications follows this pattern with an <span class="s5">Editor</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">component wrapped by an <span class="s5">EmbedEditor </span>that also connects to the service.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This then leads us to the <span class="s5">home </span>application that consumes these components.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">THE HOME APPLICATION</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="242" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_221.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 158%;text-align: left;">The home page starts up its use of these components by configuring just the remotes section of the <span class="s5">ModuleFederationPlugin </span>in the Webpack configuration.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;home&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">cms: &quot;cms@http://localhost:8080/remoteEntry.js&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">exposes: {},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">shared: { ... }, // Shared React dependencies</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="242" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_222.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">In the <span class="s5">App.jsx </span>for home we then bring in the components using <span class="s5">React.lazy </span>imports and wrap them in local <span class="s5">React.Suspense </span>wrappers that provide some nice feedback as the component loads.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const EmbedPage = React.lazy(() =&gt; import(&quot;cms/EmbedPage&quot;)); const Page = () =&gt; {</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">const { page } = useParams(); return (</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense <i>fallback</i>={&lt;div&gt;Loading&lt;/div&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">&lt;EmbedPage <i>page</i>={page} /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">There is another similar wrapper for <span class="s5">EmbedEditor </span>and both of these are used in the main page layout that uses tabs to swap between the static and editable views of the page content.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This live preview example isn’t exploring any new technical boundaries in our understanding of Module Federation. It’s a fairly simple system, and that’s the point. There is a huge business value in the reuse and synchronization of code between these two systems, and potentially even more value as the number of clients expands. And it doesn’t take any huge technical leaps to get there given the functionality provided by Module Federation.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">An ideal extension to this example would be to use the resiliency pattern as shown in Resilient Header Footer chapter in the Use Cases part. In this pattern we export the components using both federated modules and NPM, so that should the live sharing federated modules fail, you have a recent version as a fallback that you can render.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><h1 style="padding-left: 32pt;text-indent: 0pt;line-height: 95pt;text-align: left;">P<span class="h2">ART </span>T<span class="h2">HREE</span></h1><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="721" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_223.png"/></span></p><h3 style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ADVANCED MODULE FEDERATION</h3><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">3.1</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark30">FULLY FEDERATED SITES</a><a name="bookmark31">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_224.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_225.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="721" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_226.png"/></span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Code for this chapter is <u>available on GitHub</u>. There is also a <u>Blue Collar Coder video</u> associated with this practical use case.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Most large sites run on what’s labeled the “micro site” architecture where a single domain (e.g. <u>amazon.com</u>) isn’t served by a single application, but instead different routes will go to different applications. All of these applications work together through shared session state, or shared backend APIs to create what appears to be a single coherent site for the customer.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">The advantage of the micro site architecture is that each of these applications can deploy independently, because the site as a whole doesn’t need to get deployed every time one route changes. One downside, which we’ve been addressing throughout this book, is the complexity of sharing code between these different applications. But another downside is that you lose the ability to create a Single Page Application easily in this methodology. It also make it difficult to test an end-to-end flow because you’d have to inject the experience you are testing into the middle of the entire production end to end flow.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: justify;">But what if you could share whole routes between the different applications? So that each application would be able to render all the others? For example, if we had three applications; <span class="s5">home</span>, <span class="s5">search </span>and <span class="s5">profile</span>. Could we bi-directionally share between them as in the figure below.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s25" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">Search</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s25" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">Home</p><p class="s25" style="padding-top: 3pt;padding-left: 7pt;text-indent: 0pt;text-align: center;">Profile</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="378" height="158" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_227.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">So if you are working on the search application, then you federate in the home and profile applications. And as you navigate around the interface you are still technically running in the search app, but you get the entire site experience.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This is what we call a Fully Federated Site and it has some big advantages.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p></li><li style="padding-left: 22pt;text-indent: -17pt;text-align: left;"><p style="display: inline;">It can be deployed as the site itself, giving your customers a Single Page Application experience but still allowing the individual teams to deploy independently.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 32pt;text-align: left;"><p style="display: inline;">It provides a better developer experience where the contributor can see how their</p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">feature works through the entire experience.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p style="display: inline;">It means that you have the ability to completely end to end test your entire site even</p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">across multiple projects.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">AN EXAMPLE APPLICATION</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Setting up an entire fully federated application would be too much code to work through in the context of a book. So we’ve opted to provide the book code on Github and look at key sections of the code to demonstrate how it works.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">As with our other example applications if you run <span class="s5">yarn start </span>at the top of <u>this</u> <u>directory </u>you will launch all of the servers. The <span class="s5">home </span>page runs on port 3001, <span class="s5">profile </span>on 3002 and <span class="s5">search </span>on 3003. For simplicities sake we’ve put the port numbers in the same order as the alphabetical order of the project names.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">If you navigate to <u>http://localhost:3001/ </u>you’ll see the home application hosted experience.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 123pt;text-indent: 0pt;text-align: left;"><span><img width="405" height="322" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_228.jpg"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">In this version the Home tab is the only one with code actually in the application. The Search and Profile tabs are running on code provided, through module federation, by the profile and search applications on ports 3002, and 3003 respectively.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 159%;text-align: left;">To get a quick taste of the power of a fully federated site simply make a change to <span class="s5">packages/home/src/Home.jsx </span>and refresh your browser on <u>http://</u> <u>localhost:3001/</u>. Of course you would expect to see a change there, but when you navigate to <u>http://localhost:3002/</u>, the <span class="s5">profile </span>application, and <u>http://</u> <u>localhost:3003/</u>, the <span class="s5">search </span>application, you will see the changes as well.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The really impressive part about all this is that, given what we’ve learned thus far through this book, this is not anything we haven’t already seen. This is just the culmination of our existing work in understanding Module Federation.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Let’s look at the <span class="s5">webpack.config.js </span>in the <span class="s5">packages/home </span>directory. In there the</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="266" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_229.png"/></span></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ModuleFederationPlugin <span class="p">is configured like so:</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;home&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">search: &quot;search&quot;, profile: &quot;profile&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">exposes: { &quot;./Home&quot;: &quot;./src/Home&quot; }, shared: { ... }, // Shared dependencies</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">The home application specifies the <span class="s5">search </span>and <span class="s5">profile </span>applications as remotes, and exposes its own <span class="s5">Home </span>page React component. It also shares out it’s dependencies on <span class="s5">react</span>, <span class="s5">react-dom </span>and the <span class="s5">antd </span>component library.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_230.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: justify;">In the <span class="s5">App.jsx </span>file we import the different components using a combination of a straight <span class="s5">import </span>for the <span class="s5">home </span>page and lazily loaded components for <span class="s5">search </span>and <span class="s5">profile</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">Home </span>from <span class="s10">&quot;./Home&quot;;</span></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">const Profile = React.lazy(() =&gt; import(&quot;profile/Profile&quot;)); const Search = React.lazy(() =&gt; import(&quot;search/Search&quot;));</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">In the React component code for the application we use the <span class="s5">react-router-dom</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="434" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_231.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">components to select between the different routes for display:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;Routes&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">&lt;Route</p><p class="s10" style="padding-top: 3pt;padding-left: 105pt;text-indent: 0pt;line-height: 128%;text-align: left;">path=&quot;/&quot; element={</p><p class="s10" style="padding-left: 120pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div&gt;Loading home&lt;/div&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 134pt;text-indent: 0pt;text-align: left;">&lt;Home /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 120pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 105pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">/&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">&lt;Route</p><p class="s10" style="padding-top: 3pt;padding-left: 105pt;text-indent: 0pt;line-height: 128%;text-align: left;">path=&quot;/search&quot; element={</p><p class="s10" style="padding-left: 120pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div&gt;Loading search&lt;/div&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 134pt;text-indent: 0pt;text-align: left;">&lt;Search /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 120pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 105pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">/&gt;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The <span class="s5">Home </span>component we use as-is, but for the lazily loaded <span class="s5">Search </span>and <span class="s5">Profile</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">pages we use a suspense.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">If you want some more fun just check out the network tab to see just how little extra code is loaded as you navigate between the tabs.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This is certainly not the only possible way that you could construct a fully federated site. You can imagine a very small booter application that only hosts the content frame and manages navigation between the routes that are supplied via federation. By default the application would bring in the routes from production, but by changing a flag or</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">setting an environment variable an engineer could switch one of the routes to their own localhost running copy of the part of the interface they are working with.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">LARGER SCALE EXAMPLE</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">Let’s look at a much larger example system. In the sample code is an entire three application micro-site with associated node modules and micro-services located in the <span class="s5">large-example </span>directory. Shown below is a block diagram for that system.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 170pt;text-indent: 0pt;text-align: left;"><span><img width="278" height="205" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_232.jpg"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="317" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_233.png"/></span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">We have the applications at the top, Home, Search and Checkout, and they connect to some React components shared using NPM (AddToCart and Frame). And they also have a shared codebase for the redux store which holds the cart and some shared API wrappers in the logic NPM module. And all of this sits on top of two micro-services.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">And this is the kind of thing we see a lot of nowadays; the &quot;micro-site&quot; architecture. The most common architecture before that was the &quot;monolith&quot;, a single, usually Java application, where all the frontend code was in one application.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The advantage of the micro-site architecture is that each application can deploy independently. But there are some disadvantages:</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p></li><li style="padding-left: 22pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">Code sharing <span class="p">- Code sharing is really difficult - Having shared code in NPM modules creates friction to sharing code since it has to be extracted from the original</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">application, which means jumping from repo to repo, doing version bumping, etc.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">Single Page Applications (SPA) <span class="p">- SPAs are difficult to pull off with micro-sites,</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">but being on a SPA is a huge performance win for the customer. There are great</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">options like SingleSPA, but those have a learning curve.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">End-to-end testing <span class="p">- E2E testing is very difficult. How do you know when you</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">release a new version of checkout it&#39;s going to be compatible with the other micro-</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 150%;text-align: left;">sites and not break existing flows? That&#39;s what end-to-end testing is for, but staging the entire site using existing tools is very tough.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">We are going to step-by-step improve this site using Module Federation until we end up with a system that runs as a Single Page Application, has easy code sharing, and is E2E testable. In the accompanying video you can follow along with the <u>step by step</u> <u>code changes</u>. In this book we will cover the high level architectural moves.</p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Relocating the UI Components</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">First step is to move the <span class="s5">AddToCart </span>React component from components NPM library to the <span class="s5">Checkout </span>application.</p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p><p style="padding-left: 140pt;text-indent: 0pt;text-align: left;"><span><img width="364" height="267" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_234.jpg"/></span></p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">This is the natural place for that code because it&#39;s functionality that fits within the purview of the Checkout team. Then we change the Home and Search applications to remote in the <span class="s5">Checkout </span>application and import AddToCart from there.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This means that not only are we reducing the number of NPM libraries we need to version by one, but we also get live code sharing so that when Checkout updates the look or the functionality of the “Add To Cart” button the Home and Search sites will update immediately.</p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Moving The Frame (Header)</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 161%;text-align: left;">Our next stop on the train towards full site federation is to move the header (or <span class="s5">Frame</span>) component over into the <span class="s5">Home </span>application and then to expose it out to all the applications.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 118pt;text-indent: 0pt;text-align: left;"><span><img width="421" height="309" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_235.jpg"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 159%;text-align: left;">Right now <span class="s5">Frame </span>just has anchor tag links to the other applications. In a later step, because all of the content from all of the applications is exposed as remotes, we will later <span class="s5">Frame </span>to give us full SPA functionality. But for now this is a huge win because the Home page team can update the <span class="s5">Frame </span>header and all the applications will see those changes immediately after Home page deploys.</p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Moving The Business Logic</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The next thing to move is the Redux store into the Checkout application (because it only stores the cart state).</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 131pt;text-indent: 0pt;text-align: left;"><span><img width="378" height="316" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_236.jpg"/></span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">All of the applications now use the remote of Checkout to get the store redux code. This is nothing new, but when we move to a Single Page Application at the end, because the user never navigates away from the first page we will be able to retain the store in memory through the entire customer journey.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">And then there is one more move to split the business logic code between both the Checkout and Search applications.</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;"><span><img width="472" height="163" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_237.jpg"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Checkout manages the Cart Logic because it relates to their role in the system. And the Search team manages the product related API wrappers which are also shared out to any other applications that need product data or search capabilities.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Moving To A Single Page Application (SPA)</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">The final step is to move to a full SPA by exposing all the body content components for each of the applications And then linking those to the already shared Frame component using a SPA router such as <span class="s5">react-router-dom</span>.</p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p><p style="padding-left: 94pt;text-indent: 0pt;text-align: left;"><span><img width="482" height="183" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_238.jpg"/></span></p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">Because any site can vend the content from any other site a user can start on the search page application and never actually leave the original search page as they go perhaps to the home page, then back to search, and then into checkout. And that means your can</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">use an End-to-End (E2E) testing system to test the entirety of the site from initial customer visit all the way through ordering an item, with your local code changes run within that test.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This new system is conceptually easier to understand as there are less moving parts and shared components and business logic are sharing out of the applications where they are most ideally located. But, it can be hard to understand how dramatic of a change full site federation is without trying it yourself. I strongly encourage you to watch the associated video and to walk through the example before trying to migrate your site to a fully federated model.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">WHAT’S  NEXT</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s not just about sharing modules out of running applications with Module Federation. There are other ways to share code as well. In the next chapter we cover these other methods in detail.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">3.2</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark32">ALTERNATIVE DEPLOYMENT OPTIONS</a><a name="bookmark33">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_239.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="714" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_240.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Code for this chapter is <u>available on GitHub</u>.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="725" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_241.png"/></span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">Thus far we’ve been deploying federated modules from applications for consumption by other applications, but there are alternatives to that model.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">MICRO-FRONTEND MODEL</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 154%;text-align: left;">In the Micro-Frontend model we use Webpack to create a <span class="s5">dist </span>directory that we then statically deploy to a static hosting service. Amazon’s S3 service would be a good example target for this approach.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 154%;text-align: left;">Applications would then consume the <span class="s5">remoteEntry.js </span>just as they would from a remote application, but in this case there is no running application, just the federated modules.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="482" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_242.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 162%;text-align: left;">Let’s start by looking at the <span class="s5">widget </span>directory within the <span class="s5">micro-fe </span>directory of the book code for this chapter. In that directory we find the <span class="s5">webpack.config.js </span>file that just packages up the <span class="s5">Widget </span>using standard a standard <span class="s5">ModuleFederationPlugin </span>configuration.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">module.exports = { output: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">publicPath: &quot;http://localhost:3002/&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">...</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">plugins: [</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;widget&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;./Widget&quot;: &quot;./src/Widget&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">shared: { ... }, // Shared React dependencies</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">],</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And in the <span class="s5">package.json </span>we have a <span class="s5">build </span>script runs the webpack build, and a</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">start <span class="p">script that runs a static server that imitates something like S3.</span></p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">&quot;scripts&quot;<span style=" color: #BBB;">: {</span></p><p class="s28" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;"><span style=" color: #E06C75;">&quot;build&quot;</span><span style=" color: #BBB;">: </span>&quot;<span style=" color: #000;">webpack --mode production</span>&quot;<span style=" color: #BBB;">,</span></p><p class="s28" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;"><span style=" color: #E06C75;">&quot;start&quot;</span><span style=" color: #BBB;">: </span>&quot;<span style=" color: #000;">cd dist &amp;&amp; PORT=3002 npx servor</span>&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="122" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_243.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">To run this <span class="s5">widget </span>server first run <span class="s5">yarn build </span>then <span class="s5">yarn start</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">And to test it out run <span class="s5">yarn start </span>in the <span class="s5">home </span>directory that is a peer to the <span class="s5">widget</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">directory.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="362" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_244.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">The <span class="s5">home </span>application itself should be very familiar by now. The <span class="s5">ModuleFederationPlugin </span>in the <span class="s5">webpack.config.js </span>sets up widget as a remote. The index.html file includes a script tag to the <span class="s5">remoteEntry.js </span>file on our static server. And the <span class="s5">App.jsx </span>file lazily imports the <span class="s5">Widget </span>component and hosts it within a <span class="s5">Suspense </span>as show in the code below:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">import <span class="s10">React </span>from <span class="s10">&quot;react&quot;;</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">...</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;line-height: 36pt;text-align: left;">const Widget = React.lazy(() =&gt; import(&quot;widget/Widget&quot;)); const App = () =&gt; (</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;div className=&quot;mt-10 text-3xl mx-auto max-w-6xl&quot;&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;React.Suspense fallback={&lt;div&gt;Loading&lt;/div&gt;}&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">&lt;Widget /&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;/React.Suspense&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">&lt;div&gt;Home App&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">);</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The import thing to get from this exercise is that you don’t necessarily have to have the federated module code deployed with the application. Which leads us to a second possible build and deployment option; the sidecar.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">SIDECAR DEPLOYMENTS FOR WEBPACK 4</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">So you have a Webpack 4 application and it’s going to take some time to port to Webpack 5, but you want to export some of it’s modules today. What to do? Well, you could do a sidecar deployment as show in the <span class="s5">sidecar/wp4-project </span>directory.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 158%;text-align: left;">This project is, as you might guess from the name, a React application that is packaged using Webpack 4. But we want to expose the <span class="s5">src/Carousel.jsx </span>file as a federated module. How do we do that? We create a Webpack 5 project within this project in a directory called <span class="s5">wp5-sidecar </span>(though you can call it whatever you want.)</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="698" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_245.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">In the sidecar’s <span class="s5">webpack.config.js </span>there are two items worth noting:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">module.exports = { module: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">rules: [</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;line-height: 128%;text-align: left;">test: /\.(js|jsx)$/, exclude: /node_modules/, use: {</p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">loader: &quot;babel-loader&quot;,</p><p class="s11" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">options: {</p><p class="s11" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">presets: [&quot;@babel/preset-react&quot;],</p><p class="s11" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">],</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">plugins: [</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">new ModuleFederationPlugin({ name: &quot;widget&quot;,</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">filename: &quot;remoteEntry.js&quot;, remotes: {},</p><p class="s10" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s11" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&quot;./Carousel&quot;: &quot;../src/Carousel&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">shared: { ... }, // Shared React dependencies</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">}),</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">],</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">The first thing to notice is that we are setting up the babel options in the webpack configuration because babel will not find them with the relative pathing that we use to get to the <span class="s5">Carousel </span>module.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Other than that it’s a simple <span class="s5">yarn build </span>to create a <span class="s5">dist </span>directory that could be deployed to a static hosting service along with the Webpack 4 bundled code.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s true that the Webpack 4 code won’t know about the federated module Javascript or use it. But this is a method for exporting code from Webpack 4 applications today if there is going to be a lengthy migration process to Webpack 5.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">3.3</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark34">MEDUSA</a><a name="bookmark35">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_246.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">With Module Federation making it very easy to share code and components between applications it became readily apparent that we needed a way to visualize everything being shared between applications. So we created a Module Federation dashboard named Medusa and it’s available on Docker today. Here are some screenshots from a populated dashboard.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;"><span><img width="737" height="429" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_247.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">The dashboard is currently in alpha release status as we are rapidly iterating on features, adding new functionality, and changing the data model. If you want to try it</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="122" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_248.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">out you will need to use Docker to run the dashboard as shown in the shell command below:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">&gt; mkdir dashboard-data</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">&gt; docker run -p 3000:3000 \</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">--mount type=bind,source=&quot;$(pwd)&quot;/dashboard-data,target=/data \</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">-t scriptedalchemy/mf-dashboard:latest</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">This will create a local directory named <span class="s5">dashboard-data </span>that will hold the data files so that there is no data loss when the Docker image is shutdown.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: justify;">Once this is running you can go to <u>http://localhost:3000/ </u>to see the dashboard. When no data is loaded you will get a home page that explains the dashboard, what it’s useful for and how to integrate with it.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">To send data to the Dashboard we’ve developed a plugin that integrates right into your Webpack configuration. To get started first install the plugin in your project:</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_249.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">Then configure the plugin to point at the dashboard server.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: justify;">yarn add @module-federation/dashboard-plugin -D</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">const DashboardPlugin = require(“@module-federation/dashboard-plugin&quot;);</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: justify;">...</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">new DashboardPlugin({</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">dashboardURL: &quot;http://localhost:3000/api/update&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}),</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">The next time you start or build your application the dashboard plugin will automatically update the dashboard with the latest information from the build.</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">There is also additional metadata that you can add to the <span class="s5">DashboardPlugin</span></p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">configuration that is <u>documented on the NPM page for the plugin</u>.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">We are really excited about the potential for the Dashboard. It’s a level of detail and insight that isn’t available from NPM. As we continue to add new features to enhance the experience and stabilize the application</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">3.4</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark36">FREQUENTLY ASKED QUESTIONS</a><a name="bookmark37">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_250.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s hard to cover every potential use case for a technology as fundamental as Module Foundation. In this chapter, we cover a variety of related topics and questions that often arise as we roll this out in projects and organizations.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">What is the remoteEntry.js file?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 155%;text-align: left;">The <span class="s5">remoteEntry.js </span>file contains references to the exposed modules of an application. It doesn’t contain the code for those modules, but it knows where to go get the code. That’s important because it allows those modules to be lazily loaded via <span class="s5">import() </span>if that is how you choose to load your code.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 157%;text-align: left;">When you have one of the examples in this book up and running it’s worth having a look at the <span class="s5">remoteEntry.js </span>file to see what is in it so that you can get a better understanding how Module Federation works at the code level. By default the URL for <span class="s5">remoteEntry.js </span>is <u>http://localhost:8080/remoteEntry.js </u>in the getting started projects.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 164%;text-align: left;">You can name the <span class="s5">remoteEntry.js </span>file whatever you choose. The one truly important detail is that the publicPath defined in the <span class="s5">webpack.config.js </span>matches where the code is deployed. Because the <span class="s5">remoteEntry.js </span>contains references to the code, and not the code itself, Webpack uses the <span class="s5">publicPath </span>to find the modules and</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">load them asynchronously. So that <span class="s5">publicPath </span>must match the deployment location for the system to work.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Can I use Module Federation with SingleSPA?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Absolutely! In fact Module Federation is one of the two code loading styles that is covered on the <u>SingleSPA documentation website</u>. The advantage of using SingleSPA in tandem with Module Federation is that SingleSPA extends the capabilities of the solution by allowing you to host view code from multiple view frameworks (e.g. React can run on a Vue page, or vice versa.) And Module Federation allows you to share other types of code as well (i.e. business logic, etc.)</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">What about A/B Testing?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 155%;text-align: left;">A/B test code is an ideal use for Module Federation. You can expose both of the variants and use asynchronous imports (or <span class="s5">React.lazy</span>) to import which ever variant your A/B provider tells you to. In this solution you will ever only import one variation of the code.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">When should I still use NPM?</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">This question is really about the architecture of your solution and as such you should create your own criteria for that decision. That being said, here is some high level guidance on when to choose NPM over Module Federation.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p></li><li style="padding-left: 22pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">Externally shared code <span class="p">- If you are writing a wrapper for your API then - developers will expect to see that on NPM.</span></p></li><li style="padding-top: 1pt;padding-left: 22pt;text-indent: -17pt;text-align: left;"><p class="s6" style="display: inline;">Slow moving business logic <span class="p">- If it’s not going to change that often, and the upgrade procedures are very specific, then it’s probably best controlled and</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 14pt;text-align: left;">versioned as an NPM module.</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 34pt;text-align: left;"><p class="s6" style="display: inline;">When contextually appropriate <span class="p">- If similar functionality is already packaged as</span></p><p style="padding-left: 22pt;text-indent: 0pt;line-height: 16pt;text-align: left;">NPM and that functionality is not migrating to Module Federation, then you should</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 22pt;text-indent: 0pt;text-align: left;">consider sticking with NPM.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Module Federation is a new architectural paradigm and it will take time for the industry to adapt. It’s worth spending the time before rolling out Module Federation at scale to develop guidance on how to decide on packaging code as NPM packages or as federated modules.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">It’s worth noting that any code shared with NPM can always be imported an either shared using the shared module system or exports to other applications using exposes.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">3.5</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark38">TROUBLESHOOTING</a><a name="bookmark39">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_251.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">We see some common errors in Module Federation. So here’s what’s going on if you see one of them.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">UNCAUGHT ERROR: SHARED MODULE IS NOT AVAILABLE FOR EAGER CONSUMPTION</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">This is an easy one. You are eagerly executing an app which is operating in omnidirectional mode. Meaning that application A is importing from B which is in turn importing from A. You have a few options to choose from.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">You can set the dependency as eager inside the advanced API of Module Federation, which doesn’t put the modules in an async chunk, but provides them synchronously. This allows us to use these shared modules in the initial chunk. But be careful as all provided and fallback modules will always be downloaded.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="314" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_252.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">It’s wise to provide it only at one point of your app, e. g. the shell.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">shared: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;line-height: 128%;text-align: left;">...deps, react: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">eager: true, singleton: true,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">requiredVersion: deps.react,</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: -14pt;line-height: 128%;text-align: left;">&quot;react-dom&quot;: { eager: true, singleton: true,</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">requiredVersion: deps[&quot;react-dom&quot;],</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_253.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Where we define <span class="s5">deps </span>as:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">const deps = require(&quot;./package.json&quot;).dependencies;</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">If you do not want to set dependencies as <span class="s5">eager </span>then you can take advantage of</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">bundle-loader <span class="p">in your webpack configuration.</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="290" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_254.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">To do that add this loader:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">module: { rules: [</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;line-height: 128%;text-align: left;">test: /bootstrap\.js$/, loader: &quot;bundle-loader&quot;, options: {</p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">lazy: true,</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">},</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">]</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_255.png"/></span></p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Then change your entry point to look like this.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">//index.js</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">import bootstrap from &quot;./bootstrap&quot;; bootstrap();</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="146" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_256.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">Create a <span class="s5">bootstrap.js </span>file, and move the contents of your entry point code into that file:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">//bootstrap.js</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">import React from &quot;react&quot;;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 128%;text-align: left;">import ReactDOM from &quot;react-dom&quot;; import App from &quot;./App&quot;;</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ReactDOM.render(&lt;App /&gt;, <i><b>document</b></i>.getElementById(&quot;root&quot;));</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">What this does is create an opportunity for Webpack to coordinate with other remotes and decide who will vend what, before beginning to execute the application. This</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">approach will increase Round-Trip Time (RTT) as Webpack is unable to async load everything in one roundtrip.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The recommended solution to eager imports</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Methods mentioned above work, but can have some limits or drawbacks.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">With Webpack we strongly recommend a dynamic import of a bootstrap file. Doing so will not create any additional Round Trips, it’s also more performant in general as initialization code is split out of a larger chunk.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">UNCAUGHT ERROR: MODULE “./BUTTON” DOES NOT EXIST IN CONTAINER.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 154%;text-align: left;">It likely does not say button, but the error message will look similar. This issue is typically seen if you are upgrading from beta.16 to beta.18 within <span class="s5">ModuleFederationPlugin</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_257.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Change the exposes from:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;Button&quot;: &quot;./src/Button&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_258.png"/></span></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">To this:</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">&quot;./Button&quot;: &quot;./src/Button&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">The change is done so that we can follow the ESM syntax inside Node 14.</p><p class="s4" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">UNCAUGHT TYPEERROR: FN IS NOT A FUNCTION</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 157%;text-align: left;">You likely are missing the <span class="s5">remoteEntry.js</span>, make sure its added in your page template. If you have the remote entry loaded for the remote you are trying to consume, but still, see this error. Add the host’s <span class="s5">remoteEntry.js </span>file to the HTML as well.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Depending on how your application exposes, shares, and is architected. An omnidirectional host can leverage <b>its own remote </b>when coordination is taking place. This has no performance drawbacks. Webpack is just leveraging itself in an omnidirectional manner. Since its both a host and remote at the same time. It may use its own remote. This might seem strange, but this architecture is extraordinarily powerful, with omnidirectional hosts allowing dead simple ways to introduce A/B tests without ever writing a feature flag or needing to remove one.</p><h3 style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">APPENDIX A</h3><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark40">REFERENCE</a><a name="bookmark41">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_259.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 150%;text-align: left;">The sections below cover the different plugins that make up the Module Federation ecosystem within Webpack 5 and their various options.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">ModuleFederationPlugin</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Name</p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p><p class="s29" style="padding-left: 45pt;text-indent: 0pt;text-align: left;">This is the name of the module being exported.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Library (optional)</p><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><br/></p><p class="s29" style="padding-left: 45pt;text-indent: 0pt;line-height: 159%;text-align: left;">This specifies how the module is to be formatted for use in the browser context. You should use the <span class="s5">var </span>type and match the name with the module name.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_260.png"/></span></p><p class="s30" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Examples</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">{ library: { type: &quot;assign&quot;, name: &quot;app1&quot; } }</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s29" style="padding-left: 45pt;text-indent: 0pt;line-height: 161%;text-align: left;">Sets the webpack library target type to <span class="s5">var </span>under the name <span class="s5">app1</span>. There are many library target types, we recommend <span class="s5">var </span>as it will be assigned to a global variable exposed under that name and be easily referenced.</p><p class="s9" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Filename (optional)</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">The file name for the remote entry. This is optional and defaults to</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">remoteEntry.js<span class="p">.</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Remotes (optional)</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">An object that specifies the remotes this application consumes.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_261.png"/></span></p><p class="s30" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Examples</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">{ remotes: { nav: &quot;nav&quot;,</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">} }</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_262.png"/></span></p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 158%;text-align: left;">Specifies that the incoming nav federated module is a known remote and that it can be imported using the name <span class="s5">nav</span>.</p><p style="text-indent: 0pt;line-height: 5pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">{ remotes: {</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">nav: &quot;checkoutNav&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">} }</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 164%;text-align: left;">Specifies that the incoming <span class="s5">checkoutNav </span>federated module is a known remote and that it can be imported using the name <span class="s5">nav</span>.</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">{ remotes: { nav:{</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">external: &quot;nav@http://localhost:3001/remoteEntry.js&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="146" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_263.png"/></span></p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;line-height: 157%;text-align: left;">This automatically fetches the remote named <span class="s5">nav </span>from the specified URL without the requirement to add a script tag to the host page.</p><p style="text-indent: 0pt;line-height: 7pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">remoteType (optional)</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">Specifies Webpack library type for the remotes.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_264.png"/></span></p><p class="s30" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Examples</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">{ remotes: { nav: &quot;nav&quot;,</p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">}, remoteType: &quot;var&quot; }</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">Specifies that the remotes are packages as vars.</p><p class="s9" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Exposes (optional)</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 36pt;text-align: left;">The list of internal modules to exposed as federated modules.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_265.png"/></span></p><p class="s30" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Examples</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">exposes: {</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">&quot;./Header&quot;: &quot;./src/Header&quot;,</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="169" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_266.png"/></span></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">Exposes the source file <span class="s5">./src/Header </span>as the named export <span class="s5">Header</span>.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">exposes: { Header: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">import: “./src/Header”,</p><p class="s10" style="padding-top: 3pt;padding-left: 33pt;text-indent: 0pt;text-align: left;">// optional metadata</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;line-height: 157%;text-align: left;">Exposes the source file <span class="s5">./src/Header </span>as the named export <span class="s5">Header </span>with the additional metadata provided in the object.</p><p class="s9" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Shared (optional)</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 150%;text-align: left;">The list of packages that this application will share with other applications that consume its exposed modules, and share with federated modules it consumes as remotes.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_267.png"/></span></p><p class="s30" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Examples</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">{ shared: [&quot;lodash&quot;], }</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="98" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_268.png"/></span></p><p class="s31" style="padding-left: 41pt;text-indent: 0pt;line-height: 150%;text-align: left;">Shares loads without version information, or eager consumption, or as a singleton.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">shared: {</p><p class="s10" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">&quot;react&quot;: &quot;^16.12.0&quot;</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_269.png"/></span></p><p class="s31" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">Shares react with the NPM semver mechanics starting at 16.12.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">{ shared: require(“./package.json&quot;).dependencies },</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">Shares all the packages listed in the package.json dependencies.</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">{ shared: {</p><p class="s10" style="padding-top: 3pt;padding-left: 48pt;text-indent: -14pt;line-height: 128%;text-align: left;">react: { singleton: true</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="170" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_270.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="241" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_271.png"/></span></p><p class="s31" style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;line-height: 150%;text-align: left;">Shares react but marks it as a singleton meaning that only one copy can be in use in the application at one time.</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 19pt;text-indent: -14pt;line-height: 128%;text-align: left;">{shared: { react: {</p><p class="s10" style="padding-left: 33pt;text-indent: 0pt;line-height: 128%;text-align: left;">version: &quot;^16.12.0&quot;, import: &quot;react&quot;, shareKey: &quot;react&quot;, shareScope: &quot;default&quot;, singleton: &quot;true&quot;,</p><p class="s10" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">},</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s31" style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">Shares react at 16.12 as a singleton with the import name as react and in the</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">default <span class="s31">scope under the name </span>react<span class="s31">.</span></p><p class="s9" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">ShareScope (optional)</p><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">The scope name to use for the shares..</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="749" height="64" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_272.png"/></span></p><p class="s30" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Examples</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">{ shared: [&quot;lodash&quot;], shareScope: &quot;default&quot; }</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;">This sets the name of the scope to use for the shared packages to “default”.</p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ContainerPlugin</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;line-height: 164%;text-align: left;">This is the plugin that exposes modules for module federation. It accepts the <span class="s5">name</span>, <span class="s5">library</span>, <span class="s5">filename </span>and <span class="s5">exposes </span>keywords with the same options as <span class="s5">ModuleFederationPlugin</span>.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">ContainerReferencePlugin</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This is the plugin manages remotes for module federation. It accepts the <span class="s5">remoteType</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">and <span class="s5">remotes </span>keywords with the same options as <span class="s5">ModuleFederationPlugin</span>.</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s4" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">SharePlugin</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;">This is the plugin manages shares for module federation. It accepts the <span class="s5">shares </span>and</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">sharesScope <span class="p">keywords with the same options as </span>ModuleFederationPlugin<span class="p">.</span></p><p class="s32" style="padding-left: 9pt;text-indent: 0pt;line-height: 54pt;text-align: left;">APPENDIX B</p><p class="s4" style="padding-left: 9pt;text-indent: 0pt;line-height: 31pt;text-align: left;"><a name="bookmark42">GLOSSARY</a><a name="bookmark43">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_273.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;text-align: left;">Below is a glossary of the different terms used in this book and what they mean.</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 3pt;padding-left: 13pt;text-indent: 0pt;text-align: left;">Term                             Description</p><p style="text-indent: 0pt;line-height: 9pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 159pt;text-indent: -146pt;line-height: 150%;text-align: left;">Exposed                       <span class="p">A given module should be exported by the application for federation.</span></p><p class="s6" style="padding-left: 159pt;text-indent: -146pt;line-height: 150%;text-align: left;">Host                               <span class="p">The currently running application that is hosting federated remote modules.</span></p><p class="s6" style="padding-left: 159pt;text-indent: -146pt;line-height: 150%;text-align: left;">Module                         <span class="p">The smallest unit of shareable code. In the Webpack system a module can be a single file.</span></p><p class="s6" style="padding-left: 13pt;text-indent: 0pt;text-align: left;">Override                      <span class="p">The Webpack internal name for a shared package</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 13pt;text-indent: 0pt;text-align: left;">Package                        <span class="p">An NPM package.</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 13pt;text-indent: 0pt;text-align: left;">Remote                         <span class="p">A reference to an external federate module.</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 13pt;text-indent: 0pt;text-align: left;">Remote Module        <span class="p">Any file exported through Module Federation.</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 159pt;text-indent: -146pt;line-height: 150%;text-align: left;">Scope                            <span class="p">A scope is synonymous with an application. Every application is exported as one named scope.</span></p><p class="s6" style="padding-left: 159pt;text-indent: -146pt;line-height: 150%;text-align: left;">Shared                          <span class="p">A module that is shared from an application to a remote module.</span></p><p class="s6" style="padding-left: 159pt;text-indent: -146pt;line-height: 150%;text-align: left;">Shell                              <span class="p">A host application, which may provide additional APIs to the MFEs it hosts.</span></p><p class="s6" style="padding-left: 13pt;text-indent: 0pt;text-align: left;">Singleton                     <span class="p">A constraint that only a single version of this module or</span></p><p style="text-indent: 0pt;line-height: 8pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="721" height="642" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_274.png"/></span></p><p style="padding-left: 159pt;text-indent: 0pt;line-height: 150%;text-align: left;">package should be in use within that application at any given time.</p><p class="s32" style="padding-left: 9pt;text-indent: 0pt;line-height: 55pt;text-align: left;">REVISION HISTORY</p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_275.png"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 14pt;text-align: left;">v1.1.0 - 6/18/2020: Updated to beta 18</p><ul id="l7"><li style="padding-left: 26pt;text-indent: -17pt;line-height: 28pt;text-align: left;"><p style="display: inline;">Updated references from beta 17 to beta 18</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 30pt;text-align: left;"><p style="display: inline;">Fixed small inconsistencies in the code examples</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 14pt;text-align: left;">v1.2.0 - 6/26/2020: Content Upgrade</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 28pt;text-align: left;"><p style="display: inline;">Split into three parts</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Added chapter 9: Header, chapter 10: A/B tests and chapter 11: Live Previews</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 30pt;text-align: left;"><p style="display: inline;">Substantive content added to the Full Site Federation chapter</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 14pt;text-align: left;">v1.3.0 - 7/23/2020: Content Upgrade</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 28pt;text-align: left;"><p style="display: inline;">Updated all the code to v22 of Webpack 5</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Modified all the examples to use the new remote syntax</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 30pt;text-align: left;"><p style="display: inline;">Numerous context fixes and enhancements</p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 14pt;text-align: left;">v1.4.0 - 10/11/2020: Content Upgrade</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 28pt;text-align: left;"><p style="display: inline;">Updated all the code to the Webpack 5.0.0 release</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Updated the code samples on GitHub</p></li><li style="padding-left: 26pt;text-indent: -17pt;line-height: 30pt;text-align: left;"><p style="display: inline;">Updated the dynamic loading code</p><p style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;line-height: 14pt;text-align: left;">v2.0.0 - 12/26/2021: Massive content overhaul and upgrade</p></li></ul></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 28pt;text-align: left;"><p style="display: inline;">Updated all the code for all chapters</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Completely rewrote the introductory chapter</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Added a new chapter on using Create React App</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Added a new chapter on deployment</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Added a new chapter on non-React frameworks</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Added more state managers to the state management chapter</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 24pt;text-align: left;"><p style="display: inline;">Rewrote the code and copy for the CMS chapter</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 25pt;text-align: left;"><p style="display: inline;">Rewrote the code and copy for the Full Site Federation chapter</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 25pt;text-align: left;"><p style="display: inline;">Migrated all the examples to <span class="s5">create-mf-app</span></p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 25pt;text-align: left;"><p style="display: inline;">Cleaned up many inconsistencies across the chapters</p></li><li style="padding-left: 22pt;text-indent: -17pt;line-height: 30pt;text-align: left;"><p style="display: inline;">Re-structured the book to be more easily updatable</p></li></ul><p class="s33" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><a name="bookmark44">ABOUT THE AUTHORS</a><a name="bookmark45">&zwnj;</a></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="238" height="11" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_276.png"/></span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><br/></p><p style="padding-left: 13pt;text-indent: 0pt;text-align: left;"><span><img width="340" height="255" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_277.jpg"/></span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><br/></p><p style="padding-left: 8pt;text-indent: 0pt;text-align: left;"><span><img width="713" height="1" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_278.png"/></span></p><p style="padding-top: 4pt;padding-left: 13pt;text-indent: 0pt;line-height: 150%;text-align: left;">Jack Herrington is a Principal Full Stack Software Engineer. He has written seven books on a variety of topics from Podcasting to PHP and now to Module Federation. He is also the host of the Blue Collar Coder channel on YouTube which covers mainly frontend topics from beginner to advanced architecture levels. He lives in Portland, Oregon with his wife and his daughter who is attending Oregon State University.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="353" height="265" alt="image" src="Herrington und Jackson - Practical Module Federation 2.0/Image_279.png"/></span></p><p style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;line-height: 150%;text-align: left;">Zack Jackson is the Principal Javascript Architect at Lululemon and the creator of Module Federation. Zack strives to prove the impossible to be possible. He has designed distributed application architecture for over 10 years and has architected stacks consisting over 150+ independent Micro-frontends. Before Module Federation, he co-authored the code- split SSR technology that’s still used today by all React tools which offer the capability.</p></body></html>
